var prodDCutil=window.ProdDCutil||{};prodDCutil.getPermanent_id=function(){if("undefined"==typeof DDF)return DDF.permanent_id};prodDCutil.getSourceUrl=function(){var a={_url:"",_referrer:""};"undefined"==typeof DDT?(a._referrer=encodeURIComponent(document.referrer),a._url=encodeURIComponent(document.location.href)):(a._referrer=encodeURIComponent(DDT.__dd_referrer),a._url=encodeURIComponent(DDT.__dd_url));return a};
prodDCutil.time=function(){var a=0;return{setServerTime:function(b){a=b;setInterval(function(){++a},1E3)},getServerTime:function(){return a}}}();
var prodDDutil=window.ProdDDutil||{};prodDDutil.encodeJson=function(a){return JSON.stringify(a)};
var prodBuyNumber=function(a,b){function l(){b.min=1;b.max=1E4;b.type="";b.ele_tip.html("")}b.min=1;b.max=1E4;b.type="";b.type_min=["p51"];b.type_max=["p102"];b.ele=a("#buy-num");b.ele_tip=a("#buy-tip");var q=a("#num_add"),f=a("#num_del");b.add=function(){var a=b.checkBuyNumber();2!=a&&3!=a&&(a=parseInt(b.ele.val(),10),b.ele.val(a+1));b.checkBuyNumber()};b.subtract=function(){var a=b.checkBuyNumber();1!=a&&3!=a&&(a=parseInt(b.ele.val(),10),b.ele.val(a-1));b.checkBuyNumber()};b.getBuyNumber=function(){return 0<
b.ele.length?parseInt(b.ele.val(),10):1};b.setBuyNumber=function(a){var d;a.hasOwnProperty("min_limit_number")&&(d=parseInt(a.min_limit_number,10),b.min<d&&(b.min=d));a.hasOwnProperty("max_limit_number")&&(d=parseInt(a.max_limit_number,10),b.max>d&&(b.max=d));b.min>b.max&&(b.min=b.max);"type"in a&&(b.type=a.type)};b.checkBuyNumber=function(){var e=0,d="",g=parseInt(b.ele.val(),10);isNaN(g)&&(g=0);-1!=a.inArray(b.type,b.type_min)&&1<b.min&&(d+="此商品<b>"+b.min+"</b>件起购");-1!=a.inArray(b.type,b.type_max)&&
1E4>b.max?d+="每账户限购<b>"+b.max+"</b>件，超出限购数量以当当价为准":1E4>b.max&&(d+="每账户最多可购买<b>"+b.max+"</b>件");""!=d&&b.ele_tip.html(d);g<=b.min?(e+=1,b.ele.val(b.min),f.removeClass().addClass("num_del").addClass("num_disabled")):f.removeClass("num_disabled");g>=b.max&&1E4>b.max&&-1==a.inArray(b.type,b.type_max)?(e+=2,b.ele.val(b.max),q.removeClass().addClass("num_add").addClass("num_disabled")):q.removeClass("num_disabled");return e};b.bind=function(){b.checkBuyNumber();b.ele.unbind("keyup").keyup(b.checkBuyNumber);
f.off("click").on("click",function(){b.subtract()});q.off("click").on("click",function(){b.add()})};b.init=function(){a("body").off("initBuyNumber").on("initBuyNumber",l)};return b}(jQuery,window.prodBuyNumber||{}),prodOperationButtonBox=function(a,b){var l=[1,2],q=[4010620,4009636,4009637,4009638,4009643,4010649],f=[111],e=[18081],d="#part_buy_button #gift_card_button #buy_now_button #deposit_buy_button #installment_buy_button #btn_buy_now #energy_conservation #stock_no_stock #sign_no_stock #pod_buy_button".split(" "),
g=["phone_buy_button"],h=[];b.getAllButton=function(c){var k=c.stock_type;if(-1!=a.inArray(c.shop_id,e))b.addBabyButtion();else if(!(0<c.is_wireless)){if(-1==c.stock_status)b.addShoppingButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids=",c.stock_status);else if(1==c.pre_sale.isPreSale){var r={presale_type:~~c.pre_sale.type,start_date:~~c.pre_sale.startDate,end_date:~~c.pre_sale.endDate,server_time:~~c.server_time,rank_num:~~c.pre_sale.rankNum};0==c.pre_sale.type?0<c.shop_id&&
-1===a.inArray(c.shop_type,[5,6])?b.addPreSaleButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids=",r,c.shop_id,c.shop_type):0==k?b.addSoldOutButton(c.is_sold_out,c.product_id,c.server_time,c.shop_id,c.shop_type):2==k?b.addPreSaleButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids=",r,c.shop_id,c.shop_type):(b.addShoppingButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="),b.addClearingButton(k,"//checkoutb.dangdang.com/checkout.aspx?checkout_type=10&")):
0<c.pre_sale.type&&b.addDepositButton(k,"//checkoutb.dangdang.com/checkout.aspx?checkout_type=9&",r,c.shop_id,c.shop_type,c.is_sold_out,c.product_id,c.server_time);0==c.is_pod&&0<c.pod_id&&0==k&&r.start_date<=prodDCutil.time.getServerTime()&&0<a("#pod_buy_button").length&&b.addPodButton()}else 0==k?b.addSoldOutButton(c.is_sold_out,c.product_id,c.server_time,c.shop_id,c.shop_type):51==c.product_type?(b.addGiftShoppingButton(k,"http://giftcard.dangdang.com/?cardid="),b.addClearingButton(k,"//checkoutb.dangdang.com/checkout.aspx?")):
0<c.shop_id&&5==c.shop_type?(b.addShoppingButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="),b.addClearingButton(k,"//checkoutb.dangdang.com/checkout.aspx?checkout_type=7&")):1==c.is_support_installment&&c.sale_price>=~~c.installment_conf.b401.amount_lower&&c.sale_price<=~~c.installment_conf.b401.amount_upper?(b.addShoppingButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="),b.addInstallmentButton(k,c.sale_price,c.installment_conf,"//checkoutb.dangdang.com/checkout.aspx?checkout_type=13&")):
(b.addShoppingButton(k,"//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="),88!=c.activity_type&&90!=c.activity_type&&b.addClearingButton(k,"//checkoutb.dangdang.com/checkout.aspx?checkout_type=10&")),0==c.is_pod&&0<c.pod_id&&0==k&&0<a("#pod_buy_button").length&&b.addPodButton();-1<a.inArray(c.energy_level,l)&&-1<a.inArray(c.category_id,q)&&(-1<a.inArray(c.geo.province_id,f)||-1<a.inArray(c.geo.city_id,f)||-1<a.inArray(c.geo.town_id,f))&&("0"==c.shop_id||"6"==c.shop_type)&&0<k&&b.addSubsidyButton(k,
"//renzheng.customer.dangdang.com/renzheng.php?checkout_url=http%3A//checkoutb.dangdang.com/checkout.aspx%3F");return!0}};b.addMobileButton=function(a){};b.addSoldOutButton=function(c,b,e,d,g){0<d&&-1===a.inArray(g,[5,6])||0<c?(c=a("#stock_no_stock"),e=a('<a href="javascript:;" class="btn btn_red btn_disabled" id="stock_no_stock">卖光了</a>'),0<c.length&&c.remove(),a(".buy_box_btn").prepend(e),h.push("#stock_no_stock")):(c=a("#sign_no_stock"),e=a('<a href="javascript:;" class="btn btn_b btn_b_red" id="sign_no_stock" dd_name="到货通知">到货通知</a>'),
e.on("click",function(){var c=1==~~item.base.isOverSea?"http://myhome.globaldangdang.hk/productStockoutRegistration/show":"http://myhome.dangdang.com/productStockoutRegistration/show";showMsgBox("",encodeURIComponent(b+"&product_id="+b+"&source=7"),c,function(){a("body").trigger("renderAfterLogin")});return!1}),0<c.length&&c.remove(),a(".buy_box_btn").prepend(e),h.push("#sign_no_stock"))};b.addShoppingButton=function(c,b,e,d,g,f){-1==e?a("#part_buy_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name",
"").html('<i class="cart"></i>加入购物车'):(null==b&&(b="//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="),0<c?a("#part_buy_button").removeClass().addClass("btn btn_red").attr("dd_name","加入购物车").attr("go-uri",b).html('<i class="cart"></i>加入购物车'):a("#part_buy_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","加入购物车").html('<i class="cart"></i>加入购物车'));h.push("#part_buy_button")};b.addGiftShoppingButton=function(c,b,e){-1==e?a("#gift_card_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name",
"").html('<i class="cart"></i>加入购物车'):(null==b&&(b="http://giftcard.dangdang.com/?cardid="),0<c?a("#gift_card_button").removeClass().addClass("btn btn_red").attr("dd_name","礼品卡加入购物车").attr("go-uri",b).html('<i class="cart"></i>加入购物车'):a("#gift_card_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","礼品卡加入购物车").html('<i class="cart"></i>加入购物车'));h.push("#gift_card_button")};b.addClearingButton=function(b,e){null==e&&(e="//checkoutb.dangdang.com/checkout.aspx?checkout_type=10&");
0<b?a("#buy_now_button").removeClass().addClass("btn btn_b btn_b_red").attr("dd_name","立即购买").attr("go-uri",e).html("立即购买"):a("#buy_now_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","立即购买").attr("go-uri",e).html("立即购买");h.push("#buy_now_button")};b.addPreSaleButton=function(b,e,d,g,f){if(null==d)return!1;0<g&&-1===a.inArray(f,[5,6])?d.start_date>d.server_time?a("#part_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("即将开始"):d.server_time>
d.end_date?a("#part_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("结束了"):0==b?a("#part_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("卖光了"):a("#part_buy_button").removeClass().addClass("btn btn_green").attr("dd_name","预订").attr("go-uri",e).html('<i class="cart"></i>预&nbsp;&nbsp;订'):0<b?a("#part_buy_button").removeClass().addClass("btn btn_green").attr("dd_name","预订").attr("go-uri",e).html('<i class="cart"></i>预&nbsp;&nbsp;订'):
a("#part_buy_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","加入购物车").html('<i class="cart"></i>加入购物车');h.push("#part_buy_button")};b.addDepositButton=function(c,e,d,g,f,n,m,l){a("#invite_friend_button").hide();a("#deposit_buy_button").parent().find(".tuan").hide();1<d.rank_num&&0!=c&&(a("#invite_friend_button").show(),a("#deposit_buy_button").parent().find(".tuan").show());d.start_date>d.server_time?a("#deposit_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("即将开始"):
d.server_time>d.end_date?(a("#deposit_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("结束了"),a("#invite_friend_button").hide(),a("#deposit_buy_button").parent().find(".tuan").hide()):0==c?0<g&&-1===a.inArray(f,[5,6])?a("#deposit_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("卖光了"):(a("#deposit_buy_button").removeClass().removeAttr("dd_name").empty(),b.addSoldOutButton(n,m,l,g,f),a("#invite_friend_button").hide(),a("#deposit_buy_button").parent().find(".tuan").hide()):
1==d.presale_type?a("#deposit_buy_button").removeClass().addClass("btn btn_orange").attr("dd_name","先下手为强").attr("go-uri",e).html("先下手为强"):1==d.rank_num?a("#deposit_buy_button").removeClass().addClass("btn btn_orange").attr("dd_name","支付定金").attr("go-uri",e).html("支付定金"):a("#deposit_buy_button").removeClass().addClass("btn btn_orange").attr("dd_name","参加拼团").attr("go-uri",e).html("参加拼团");a("#ebook_buy_button").hide();h.push("#deposit_buy_button");a("#deposit_buy_button").hasClass("btn_disabled")?
a(".down_payment .step01").removeClass("step_hover"):a(".down_payment .step01").addClass("step_hover")};b.addFavorButton=function(b,e){0==b&&0<a("#btn_buy_now").length&&(a("#btn_buy_now").attr("go-uri",e),h.push("#btn_buy_now"))};b.addSubsidyButton=function(b,e){if(0<b&&0<a("#energy_conservation").length){var d;a("#energy_conservation").attr("go-uri",e);a(".buy_box_btn #energy_conservation").hover(function(){var b=a(this);d=setTimeout(function(){b.addClass("btn_pop_hover")},300)},function(){a(this).removeClass("btn_pop_hover");
clearTimeout(d)});h.push("#energy_conservation")}};b.addInstallmentButton=function(b,e,d,g){if(0<b&&0<a("#installment_buy_button").length){b={};b.bank_name=d.b401.bank_name;b.list=[];for(var f=0;f<d.b401.nper.length;f++){var n={};n.price=0<e?Math.round(100*e/d.b401.nper[f].number)/100:0;n.nper=d.b401.nper[f].number;n.rule=100*d.b401.nper[f].rule+"%";b.list.push(n)}a("#installment_buy_button ul").html(juicer('<li>\r\n                    <div class="title">银行</div>\r\n                    <div class="fei row01">${bank_name}</div>\r\n                  </li>\r\n                  {@each list as item,index}\r\n                  <li>\r\n                    <div class="title">${item.nper}期</div>\r\n                    <div class="fei"><b>￥${item.price}</b>X${item.nper}<span>手续费${item.rule}</span></div>\r\n                  </li>\r\n                  {@/each}\r\n                ',
b));var m;a("#installment_buy_button").attr("go-uri",g);a(".buy_box_btn #installment_buy_button").hover(function(){var b=a(this);m=setTimeout(function(){b.addClass("btn_pop_hover")},300)},function(){a(this).removeClass("btn_pop_hover");clearTimeout(m)});h.push("#installment_buy_button")}};b.addEbookButton=function(a){};b.addBabyButtion=function(){h.push("#baby_buy_button")};b.addPodButton=function(){h.push("#pod_buy_button")};b.bind=function(c){h=[];b.getAllButton(c);dragonTacticButton.bind();a(a.grep(d,
function(b){return-1==a.inArray(b,h)},!1).join(",")).hide();a(h.join(",")).show();if(-1==a.inArray(a(h[0]).attr("id"),g)){c=a("#tab_pannel_btn");var e=a("#buyarea_tab");0<c.length&&c.remove();e.prepend(a(h[0]).clone().removeAttr("id").attr("id","tab_pannel_btn").attr("ddt-expose","on").attr("ddt-src",a(h[0]).attr("ddt-src").replace(/1/,"2")).on("click",function(){a(h[0]).click()}))}};return b}(jQuery,window.prodOperationButtonBox||{}),dragonTacticButton=function(a,b){var l=[{id:"#part_buy_button.btn_red",
text:"加入购物车",ddtSrc:"addChart1"},{id:"#part_buy_button.btn_red btn_disabled",text:"加入购物车",ddtSrc:"addChartGrey1"},{id:"#gift_card_button.btn_red",text:"加入购物车",ddtSrc:"giftCard1"},{id:"#gift_card_button.btn_red btn_disabled",text:"加入购物车",ddtSrc:"giftCardGrey1"},{id:"#part_buy_button.btn_green",text:"预订",ddtSrc:"presaleButton1"},{id:"#part_buy_button.btn_disabled",text:"即将开始",ddtSrc:"beforeSale1"},{id:"#part_buy_button.btn_disabled",text:"结束了",ddtSrc:"overSale1"},{id:"#part_buy_button.btn_disabled",
text:"卖光了",ddtSrc:"soldOutPresale1"},{id:"#buy_now_button.btn_b_red",text:"立即购买",ddtSrc:"buyNow1"},{id:"#buy_now_button.btn_red btn_disabled",text:"立即购买",ddtSrc:"buyNowGrey1"},{id:"#deposit_buy_button.btn_orange",text:"先下手为强",ddtSrc:"depositPayAll1"},{id:"#deposit_buy_button.btn_orange",text:"支付定金",ddtSrc:"depositPayPart1"},{id:"#deposit_buy_button.btn_orange",text:"参加拼团",ddtSrc:"depositGroup1"},{id:"#deposit_buy_button.btn_disabled",text:"即将开始",ddtSrc:"beforeDeposit1"},{id:"#deposit_buy_button.btn_disabled",
text:"结束了",ddtSrc:"overDeposit1"},{id:"#deposit_buy_button.btn_disabled",text:"卖光了",ddtSrc:"soldOutDeposit1"},{id:"#installment_buy_button_a.btn_blue",text:"分期付款",ddtSrc:"installment1"},{id:"#btn_buy_now.btn_b_red",text:"收藏商品",ddtSrc:"productCollect1"},{id:"#energy_conservation_a.btn_green02",text:"参加节能补贴",ddtSrc:"energy1"},{id:"#stock_no_stock.btn_disabled",text:"卖光了",ddtSrc:"soldOut1"},{id:"#sign_no_stock.btn_b_red",text:"到货通知",ddtSrc:"sign1"},{id:"#pod_buy_button.btn_red",text:"单印一本",ddtSrc:"podBuy1"},
{id:"#baby_buy_button.btn_red03",text:"定制",ddtSrc:"babyBuy1"}];b.bind=function(){for(var b=a(".buy_box_btn"),f=0;f<l.length;f++)if(void 0!=b.find(l[f].id)){var e=a(l[f].id).text().replace(/\s/ig,"").replace("  ","");a(l[f].id).removeAttr("ddt-src").attr("ddt-src","");l[f].text==e&&a(l[f].id).removeAttr("ddt-src").attr("ddt-src",l[f].ddtSrc).attr("ddt-expose","on")}};return b}(jQuery,window.dragonTacticButton||{}),prodOperation=function(a,b){function l(){var a={};a.server_time=prodDCutil.time.getServerTime();
a.activity_type=item.hasOwnProperty("activity")?~~item.activity.type:0;a.product_id=~~item.base.productId;a.category_id=~~item.base.categoryId;a.energy_level=~~item.base.energyLevel;a.is_catalog=~~item.base.isCatalog;a.is_wireless=~~item.base.isWireless;a.is_sold_out=~~item.base.isSoldOut;a.product_type=~~item.base.productType;a.shop_type=~~item.base.shopType;a.shop_id=~~item.base.shopId;a.ebook_product_id=~~item.base.EBookId;a.stock_status=~~item.stock.stockStatus;a.stock_type=geo.stockInfo().stockType.toLowerCase();
a.pre_sale={};a.pre_sale.startDate=~~item.preSale.startDate;a.pre_sale.endDate=~~item.preSale.endDate;a.pre_sale.type=~~item.preSale.type;a.pre_sale.isPreSale=~~item.preSale.isPreSale;a.pre_sale.rankNum=~~item.preSale.rankNum;a.sale_price=price.getFinalPrice();a.is_support_installment=~~item.price.isSupportInstallment;a.is_pod=~~item.base.isPod;a.pod_id=~~item.base.podId;1==a.is_support_installment&&(a.installment_conf=item.attachInfo.installmentInfo);switch(a.stock_type){default:a.stock_type=1;break;
case "prestock":case "presale":a.stock_type=2;break;case "nostock":a.stock_type=0}var d=geo.getGeoInfo();a.geo={province_id:~~d.province.id,city_id:~~d.city.id,town_id:~~d.town.id};prodBuyNumber.bind();prodOperationButtonBox.bind(a);b.bind(a)}var q=function(b){for(var d=[3,28,229],g=[],h=a("#promo-list"),c={product:[],moduleType:"",promotion:{},buttonType:a("#part_buy_button").hasClass("btn_green")?"3":"1"},k=!1,f=0;f<d.length;f++){var p=h.find("div[data-promotype="+d[f]+"]");0<p.length&&void 0!=
p.data("select-pid")&&void 0!=p.data("select-prd-price")&&(p.find("li[data-pid='"+p.data("select-pid")+"']").data("is-spu")&&(k=!0),229!=d[f]&&(c.moduleType=d[f]),c.product.push({productId:p.data("select-pid"),productCount:1,selectProductId:"",isLocal:0,promotion:{promoPrice:p.data("select-prd-price"),promoId:p.data("promoid")+"",promoType:d[f]}}),p={promotionId:a.trim(p.attr("data-promoid")),gift:[{giftId:a.trim(p.data("select-pid")),giftCount:1}]},g.push(p))}if(k)return b={productId:item.base.productId,
productCount:prodBuyNumber.getBuyNumber(),selectProductId:item.base.productId,isLocal:1},c.product.unshift(b),showListsPop(c),!1;c=prodDCutil.getSourceUrl();d={};d.product=[{productId:b.product_id,productCount:prodBuyNumber.getBuyNumber(),promotion:g}];d.referer=c._url;d.prev_referer=c._referrer;return encodeURIComponent(prodDDutil.encodeJson(d))},f=function(e){var d=e.data,g=e.target||e.srcElement;if(a(g).hasClass("btn_disabled"))return!1;if("part_buy_button"==a(g).attr("id"))(e=q(d))&&window.open(a(g).attr("go-uri")+
e,"_self");else if("buy_now_button"==a(g).attr("id"))showMsgBox(a(g).attr("id"),"","",function(){var b;b={product_ids:"",gift_id:"",exchange_id:"",exchange_price:"",addmoney_id:"",addmoney_price:"",referer:"",prev_referer:""};"undefined"!=typeof d.product_id&&(b.product_ids=d.product_id+"."+prodBuyNumber.getBuyNumber());for(var e=[3,28,229],f=a("#promo-list"),h={product:[],moduleType:"",promotion:{},buttonType:"2"},l=!1,n=0;n<e.length;n++){var m=f.find("div[data-promotype="+e[n]+"]");0<m.length&&
void 0!=m.data("select-pid")&&void 0!=m.data("select-prd-price")&&(m.find("li[data-pid='"+m.data("select-pid")+"']").data("is-spu")&&(l=!0),229!=e[n]&&(h.moduleType=e[n]),h.product.push({productId:m.data("select-pid"),productCount:1,selectProductId:"",isLocal:0,promotion:{promoPrice:m.data("select-prd-price"),promoId:m.data("promoid")+"",promoType:e[n]}}),28==e[n]?(b.exchange_id=a.trim(m.data("select-pid")),b.exchange_price=a.trim(m.data("select-prd-price"))):3==e[n]?b.gift_id=a.trim(m.data("select-pid")):
229==e[n]&&(b.addmoney_id=a.trim(m.data("select-pid")),b.addmoney_price=a.trim(m.data("select-prd-price"))))}l?(b={productId:item.base.productId,productCount:prodBuyNumber.getBuyNumber(),selectProductId:item.base.productId,isLocal:1},h.product.unshift(b),showListsPop(h),b=!1):(h=prodDCutil.getSourceUrl(),b.referer=h._url,b.prev_referer=h._referrer,b=a.param(b));b&&(window.location.href=a(g).attr("go-uri")+b);return!0});else if("deposit_buy_button"==a(g).attr("id")){var f=a(g).attr("go-uri")+"product_ids="+
d.product_id+"."+prodBuyNumber.getBuyNumber();window.open(f,"_self")}else{if("phone_buy_button"==a(g).attr("id"))return a("#phone_buy_button").prev().children("img").attr("src","/?r=callback/mobile-qr&productId="+d.product_id),a("#phone_buy_button").parent().toggleClass("btn_pop_click"),!1;if("installment_buy_button_a"==a(g).attr("id"))f=a(g).parent().attr("go-uri")+"product_ids="+d.product_id+"."+prodBuyNumber.getBuyNumber(),window.open(f,"_self");else{if("btn_buy_now"==a(g).attr("id"))return b.addFavor("btn_buy_now",
d.product_id,a(g).attr("go-uri"));"ebook_buy_button"!=a(g).attr("id")&&("energy_conservation_a"==a(g).attr("id")?(e={checkout_type:8,product_ids:d.product_id},f=a(g).parent().attr("go-uri")+encodeURIComponent(a.param(e))+"&checkout_ddname=%u53BB%u7ED3%u7B97",window.open(f,"_self")):"baby_buy_button"==a(g).attr("id")?(f=a(g).attr("go-uri"),showMsgBox(a(g).attr("id"),"","",function(){window.location.href=f})):"gift_card_button"==a(g).attr("id")&&(f=a(g).attr("go-uri")+d.product_id+"&count="+prodBuyNumber.getBuyNumber()+
"#gift_card",window.open(f,"_self")))}}return!0};b.addFavor=function(b,d,f){showMsgBox(b,d,f,function(){a("body").trigger("renderAfterLogin")});return!1};b.bind=function(b){a(".buy_box_btn").off("click").on("click",b,f)};b.init=function(){a("body").off("initOperation").on("initOperation",l)};return b}(jQuery,window.prodOperation||{});
var mainImg=function(a){function n(){return{productId:item.base.productId,productName:item.base.productName,isPublish:"publish"==item.base.template,originalPrice:item.price.originalPrice,isOversea:item.base.isOverSea}}function r(){a("#masksClose").click(function(){a(q).hide()});var b=a("#mask-small-list-slider"),c=parseInt(b.children().length%6);0!==c&&(c=6-c);for(var d=0;d<c;d++)b.append("<li></li>");c=200;6>=b.find(">li").length&&(a("#mask-down, #mask-up").hide(),c=0);var e=0,f=!1;a("#mask-small-list").jCarouselLite({btnNext:"#mask-down",
btnPrev:"#mask-up",visible:6,scroll:6,vertical:!0,speed:c,afterEnd:function(c){a(b).find(">li").removeAttr("idx");d=0;a.each(a(c),function(b,c){a(c).css({opacity:.5}).attr("idx",d++)});if(f){var k=a(b).find("> li:has(a)[idx]").length-1;a(c[k]).find("a").trigger("click");e=k;f=!1}else a(c[0]).find("a").trigger("click"),e=0}});a(b).find(">li").css({opacity:.5});for(c=6;12>c;c++)a(b.find("li")[c]).attr("idx",c-6);a(b.find("li")[6]).css({opacity:1});b.find("> li > a").on({click:function(){a("#modalBigImg").prop("src",
a(this).data("imghref"));b.find("> li").css({opacity:.5});a(this).parent().removeClass().css({opacity:1});e=parseInt(a(this).parent().attr("idx"))},mouseover:function(){a(this).trigger("click")}});a("#mask-left").on("click",function(){0==e?(a("#mask-up").trigger("click"),f=!0):(--e,a(b).find("> li[idx="+e+"] > a").trigger("click"))});a("#mask-right").on("click",function(){var c=a(b).find("> li:has(a)[idx]").length-1;e==c?a("#mask-down").trigger("click"):(e+=1,a(b).find("> li[idx="+e+"] > a").trigger("click"))})}
function t(){function b(b,c,f,h,k,g){a.getJSON(window.localUrl,{r:"callback/get-share-data",productId:b,productName:encodeURI(c),originalPrice:h,price:f,promotionType:k,priceTitle:encodeURI(g)},function(b){""===b.errMsg&&(b=b.data,a.each(a("#share-url").find("> li"),function(c,d){if(a(d).data("dstweb")in b){var e=a(d).data("dstweb");a(d).find(">a").attr("onclick",b[e]);a(d).find(">a").attr("href",b[e])}}),a.each(a("#deposit-share-url").find("a"),function(c,d){if(a(d).data("dstweb")in b){var e=a(d).data("dstweb");
a(this).attr("onclick",b[e]);a(this).attr("href",b[e])}}))})}var c=!1;a("#share_div, #deposit-share").hover(function(){"share_div"==this.id?a("#share-url").show():"deposit-share"==this.id&&a(this).addClass("btn_pop_hover");if(0==c){var d=n(),e=a("#main-image-icon").data("promotype");b(d.productId,d.productName,price.getFinalPrice,d.originalPrice,e,"当当价");c=!0}},function(){"share_div"==this.id?a("#share-url").hide():"deposit-share"==this.id&&a(this).removeClass("btn_pop_hover")})}function u(){var b=
a("#main-img-slider"),c=parseInt(b.children().length%5);5>=b.find(">li").length&&a("#next_slide, #pre_slide").css({display:"none"});0!==c&&(c=5-c);for(var d=0;d<c;d++)b.append("<li></li>");a("#main-img-slide").jCarouselLite({btnNext:"#next_slide",btnPrev:"#pre_slide",visible:5,scroll:5});b.find("> li > a").on("click mouseenter",function(){a("#largePic").prop("src",a(this).data("imghref"));a("#detailPicDiv").find("img").prop("src",a(this).data("imghref").replace(/(_w|_k)/,"_u"));a(b).find(">li").removeClass("on");
a(this).parent().addClass("on")})}function v(){var b=a("#collect_left");b.click(function(){var c=1==n().isOversea?"//wish.globaldangdang.hk/wishlist/remote_addtofavorlist.aspx":"//wish.dangdang.com/wishlist/remote_addtofavorlist.aspx";showMsgBox("",n().productId,c,function(){b.addClass("btn_scsp_on");b.html(b.html().replace(/收藏商品/,"已收藏"));a("body").trigger("renderAfterLogin")});return!1})}var p={},g=a("#largePicDiv"),q=a("#modalMainImg"),l=[];p.init=function(){g.mouseenter(function(){1!=g.data("isTag")&&
a("#moveMask, #detailPicDiv").show()}).mouseleave(function(){a("#moveMask, #detailPicDiv").hide()}).mousemove(function(b){var c=b||event,d=a("#largePic");b=a("#moveMask");var e=a("#detailPic"),f=a(b).width(),h=a(b).height(),k=a(d).width(),g=a(d).height(),m=c.pageX-a(d).offset().left,c=c.pageY-a(d).offset().top,d=f/2,l=k-f/2,f=h/2,h=g-h/2,m=m<d?0:m>l?l-d:m-d,h=c<f?0:c>h?h-f:c-f;a(b).css({left:m+"px",top:h+"px"});a(e).css({left:parseInt(a(b).css("left"))*(-800/k)+"px",top:parseInt(a(b).css("top"))*
(-800/g)+"px",position:"absolute"})}).click(function(b){"icon_online"!=a(b.target).prop("class")&&a(q).show()});g.find(".icon_online").mouseover(function(){a("#moveMask, #detailPicDiv").hide();g.data("isTag",!0)}).mouseleave(function(){g.data("isTag",!1);a("#moveMask, #detailPicDiv").show()});u();r();t();v()};p.icon={set:function(b,c,d){var e;b={url:b.src,discount:price.getFinalDiscount()};0===l.length&&(e=a("#promo-icon-tpl").find(">script"),a.each(e,function(b,c){var d=a(c).data("type");l[d]=a(c)}));
e=a("#main-image-icon");"flash"==c?e.html(juicer(l.flash.html(),b)):e.attr("style",juicer(l.ordinary.html(),b));e.data("type",c);void 0!=d&&e.data("promotype",d)},unset:function(){var b=a("#main-image-icon");b.html("");b.attr("style","");b.data("promotype","-1")},getIconType:function(){var a=icon_node.data("type",a);return void 0==a?"":a}};return p}(jQuery);
var Cookie={Get:function(d){for(var c=document.cookie.split("; "),a,b=0;b<c.length;b++)if(a=c[b].split("="),a[0]===d)return unescape(a[1])}};
var freight=function(e){function h(){return{shopId:item.base.shopId,templateId:item.base.templateId}}function r(b,c,h){function l(b,g){e.getJSON(window.localUrl,{r:"callback/get-geography",areaId:k[d[a-1]].id},function(a){if(""==a.errMsg){var d="",p;for(p in a.data.geography)d+='<option data-gid="'+p.substr(1)+'">'+a.data.geography[p]+"</option>";e(f.find("select")[b-1]).html(d).val(g)}})}function q(){for(a=1;a<d.length;a++)if(-1==k[d[a]].id)return k[d[a-1]].id;return k.district.id}var k=e.extend(!0,
{},b),d=["country","province","city","district"],a,n;for(a=1;a<d.length;a++)-1==b[d[a]].id?e(f.find("select")[a-1]).html("<option id='-1'>请选择</option>"):(n=b[d[a]].name,l(a,n));m(c,q(),h,2);this.setBind=function(){f.find("select").change(function(){var b=e(this).find("option:selected"),g=e(this).index(),c=d[g];if("-1"!=b.data("gid")){k[c]={id:b.data("gid"),name:b.text()};for(a=g+1;a<d.length;a++)k[d[a]].id=-1;for(a=g+1;a<d.length-1;a++)e(f.find("select")[a]).html("<option>请选择</option>");2>=g?e.getJSON(window.localUrl,
{r:"callback/get-geography",areaId:q()},function(a){if(""==a.errMsg&&0!=a.data.geography.length){var b="",d=0,c;for(c in a.data.geography)b+='<option data-gid="'+c.substr(1)+'">'+a.data.geography[c]+"</option>",d+=1;1==d?(e(f.find("select")[g]).html(b),e(f.find("select")[g]).trigger("change")):(b='<option data-gid="-1">请选择</option>'+b,e(f.find("select")[g]).html(b))}}):e(f.find("select")[g]).val(k[c].name)}});f.find(".area > a").unbind().bind("click",function(){m(c,q(),h,2)})}}var c={},b=e("#freight"),
f=e("#shop-freight"),n=e("#special-freight"),m=function(c,h,m,l){0==c?-1!=e.inArray(~~geo.getGeoInfo().province.id,[171,172,173])?(b.hide(),n.show()):(b.show(),n.hide()):("1"==l?b.html(""):f.find("ul").html(""),e.getJSON(window.localUrl,{r:"/callback/shipping",shopId:c,areaId:h,templateId:m,type:l},function(c){""===c.errMsg&&(1==l?b.html(c.data):f.find("ul").html(c.data))}))};c.init=function(){0==h().shopId?b.hover(function(){0<b.find(">ul").length&&b.find(">ul").show()},function(){0<b.find(">ul").length&&
b.find(">ul").hide()}):b.click(function(){(new r(geo.getGeoInfo(),h().shopId,h().templateId)).setBind();f.show();f.find(".close").click(function(){f.hide()})})};c.set=m;c.clear=function(){0<h().shopId&&b.text("")};c.setNoSupport=function(){b.text("不支持配送")};c.show=function(){};return c}(jQuery);
var shop=function(b){function e(){return{productId:item.base.productId,shopId:item.base.shopId,ddShopId:item.base.ddShopId,isGiftPackaging:item.base.isGiftPackaging,isSupportReturnPolicy:item.base.isSupportReturnPolicy,isPresent:item.base.isPresent,categoryPath:item.base.categoryPath,isPod:item.base.isPod}}function f(a){b("#shop-info").html(a);b("#shop-score-jt, #shop-score-pop").hover(function(){b(this).addClass("score_hover");b(this).siblings("#shop-score-pop").show()},function(){b(this).removeClass("score_hover");
b(this).siblings("#shop-score-pop").hide()})}function l(a){var c=b("#shop-service");c.html(a).show();b.each(c.find(">li"),function(a,c){b(c).hover(function(){b(this).toggleClass("pic_hover")})});(function(){function a(c){for(var e=[4010415],d=0;d<e.length;d++)if(-1!=b.inArray(e[d],c))return!0;return!1}var c=[];0<e().shopId||(b.each(b("#detail-category-path").find("a"),function(a,d){c.push(b(d).data("category-id"))}),a(c)&&b("#shop-service").find(".J-lpk").removeClass().addClass("zclpk2 other").find("a").text("不支持礼品卡"))})()}
function m(){var a=b("#shop_collect_btn");if(0!=a.length){var c=b("#shop_collect"),d=c.find(".J-pop-window"),g=c.find(".J-msg"),h=c.find(".J-icon"),k=c.find("script.J-shop-collect-check");a.off().click(function(){showMsgBox("shop_collect_btn","","",function(){b("body").trigger("renderAfterLogin");var a=e(),f=a.shopId,a=void 0==a.ddShopId?0:a.ddShopId;(new Date).getTime();b.getJSON(window.localUrl,{r:"callback/shop-collect",shopId:f,ddShopId:a,timestamp:(new Date).getTime()},function(a){""!=a.errMsg&&
(g.text("店铺收藏失败"),h.removeClass().addClass("icon icon_w"),k.hide());switch(a.data){case "1":g.text("店铺收藏成功");g.append(k.html());h.removeClass().addClass("icon");break;case "2":g.text("您已收藏该店铺"),g.append(k.html()),h.removeClass().addClass("icon icon_w")}c.show();a=d.width();var e=b(window).width(),f=d.height(),f=(b(window).height()-f)/2;d.css("left",(e-a)/2).css("top",f).show()})})});c.find(".J-confirm, .J-close").off().click(function(){c.hide()})}}function n(){var a=b("#sellers_list"),c=e();0!=a.length&&
b.getJSON(window.localUrl,{r:"callback/spu-prod",productId:c.productId,shopId:c.shopId},function(d){""!=d.errMsg||""==d.data?a.hide():(d.data.productId=c.productId,d.data.shopId=c.shopId,0<d.data.itemInfo.length&&a.html(juicer(b("#sellers_list-tpl").html(),d.data)))})}function p(){b.getJSON(window.localUrl,{r:"callback/score-service",productId:e().productId,shopId:e().shopId,isGiftPackaging:e().isGiftPackaging,isSupportReturnPolicy:e().isSupportReturnPolicy,categoryPath:e().categoryPath,isPod:e().isPod},
function(a){""==a.errMsg&&(a=a.data,a.hasOwnProperty("shopScore")&&f(a.shopScore),a.hasOwnProperty("shopService")&&l(a.shopService))});!isWidth&&b("#shop_btn").click(function(){b("#service-more").toggleClass("service_more_hover")});m()}return{init:function(){1!==~~e().isPresent&&(p(),n())}}}(jQuery);
var price=function(c){function h(){var a=window.item;return{price:a.price,productId:a.base.productId,shopId:a.base.shopId,eBookId:a.base.eBookId,preSale:a.preSale,isPresent:a.base.isPresent,isVirtualProduct:a.base.isVirtualProduct,isPod:a.base.isPod,podId:a.base.podId}}function t(){return-1===u?h().price.salePrice:parseFloat(u)}function z(a){function b(b){var c=Math.floor(b/3600/24),d=Math.floor((b-86400*c)/3600),e=Math.floor((b-86400*c-3600*d)/60);b=Math.floor(b%60);10>d&&(d="0"+d);10>e&&(e="0"+
String(e));10>b&&(b="0"+b);var A="<span>"+a.text+"</span>";0!==c&&(A+="<b>"+c+"</b><span>天</span>");g.html(A+("<b>"+d+"</b><span>时</span><b>"+e+"</b><span>分</span><b>"+b+"</b><span>秒</span>")).parent().show()}"limit"in a||(a.limit=!0);var g=c("#duration-time");g.parent().hide();"style"in a?g.parent().addClass("price_time_dj"):g.parent().removeClass("price_time_dj");"promotion_more_url"in a?(g.parent().find("#promo-more").show().find("a").attr("href",a.promotion_more_url),g.parent().find("#presale-rule").hide()):
g.parent().find("#promo-more").hide();a.hasOwnProperty("text")||(a.text="距结束还有");var d=a.durationTime;(!a.limit||259200>d)&&b(d);clearInterval(q);q=setInterval(function(){0>=d||"stopCondition"in a&&!a.stopCondition()?("callback"in a&&a.callback(),clearInterval(q),c("body").trigger("updatePromo").trigger("initOperation")):((!a.limit||259200>d)&&b(d),--d)},1E3)}function H(a){var b=c("#mobile-price"),g=!1;"mobilePrice"in a&&t()>parseFloat(a.mobilePrice)?(b.find(".pr").html("<span class='yen'>&yen;</span>"+
a.mobilePrice),b.find("div > img").prop("src","/?r=callback/mobile-qr&productId="+h().productId),b.off().hover(function(){c(this).toggleClass("price_ph_hover")}).show(),g=!0):(b.hide(),b.off("hover"),g=!1);return g}function w(a){var b="",g=c("#dd-vip"),b="shop"===a?b+"店铺"+e.userShopType.name:e.name;g.show().find(">span").html(b)}function E(){function a(){if("realStock"===v.stockType)x=m=!1;else{var a=c("#geo-info");c("#arrive-time");x=!0;var d=f.price.salePrice,l={price:{directPrice:r(d)},type:"preSalePrice",
data:{text:"预售价"}},k=h().price;"1"==k.isVipDiscount&&(l.price.vipPrice={p1:d*k.discount.d1,p2:d*k.discount.d2,p3:d*k.discount.d3});c("body").trigger("updatePrice",l);g(f.preSale.title);0<~~f.shopId&&(0<f.preSale.startDate-e?(z({limit:!1,style:"price_time_dj",text:"距开始还有",durationTime:f.preSale.startDate-e}),a.find(">div > b").hide()):0<f.preSale.endDate-e?z({limit:!1,style:"price_time_dj",text:"距结束还有",durationTime:f.preSale.endDate-e}):a.find(">div > b").hide(),b("ordinary"))}}function b(a){k.find("> div[data-type="+
a+"]").attr("style","").siblings("div").hide();k.show().off().hover(function(){"ordinary"==a?c(this).toggleClass("yushou_hover"):"deposit"==a&&c(this).toggleClass("mingxi_hover")})}function g(a){c("#presale-title").html(a).show()}function d(a){var b=[];1==a.type?(a=r(a.depositAmount),b.push('<div class="price_hdj">（含定金：&yen'),b.push(a),b.push("）</div>")):2==a.type&&1==a.rankNum&&(a=r(a.rankList[0].price),b.push('<div class="price_d price_dj price_dj02"><p class="t">预售价</p><p><span class="yen">&yen</span>'),
b.push(a),b.push("</p></div>"));c("#pc-price").find(".price_d").after(b.join(""))}var f=h(),e=prodDCutil.time.getServerTime(),k=c("#presale-rule"),v=geo.stockInfo();c("#pc-price").find(".price_dj,.price_hdj").remove();c("#presale-rule").hide();c("#presale-title").hide();c("#buyarea_price").siblings("span[data-type=dj]").remove();if(0===~~f.preSale.isPreSale&&"preSale"===v.stockType)a();else if(0===~~f.preSale.isPreSale)x=m=!1;else switch(~~f.preSale.type){case 0:a();break;case 1:case 2:m=!0,c("#dd-zhe").hide(),
1===~~f.preSale.type?l(f.preSale.rankList[0].price,"预售价"):1===f.preSale.rankList.length?l(f.preSale.depositAmount,"定金"):l(f.preSale.depositAmount,"拼团定金"),g(f.preSale.title),d(f.preSale),b("deposit"),"noStock"!==v.stockType&&(c("#geo-info").find(">div > b").text("可预订"),v.stockType="preSale"),(0>f.preSale.endDate-e||0<f.preSale.startDate-e)&&c("#geo-info").find(">div > b").hide()}}function F(){var a=h(),b;b=0>=~~a.eBookId||0<a.shopId?!1:m?!1:!0;b?c.getJSON(window.localUrl,{r:"callback/product-info",
productId:a.eBookId,isCatalog:0,shopId:0},function(a){if(""===a.errMsg){var b=a.data;a=b.spu.promotion;var e=c("#e-book-price");"p230"in a?(e.html(a.p230.price.directPrice),setTimeout(function(){e.html(b.spu.price.salePrice)},a.p230.endTime-prodDCutil.time.getServerTime())):"p102"in a&&(e.html(a.p102.price.directPrice),setTimeout(function(){e.html(b.spu.price.salePrice)},a.p102.endTime-prodDCutil.time.getServerTime()))}}):(F=function(){},c("#pc-price").siblings(".price_e").remove())}function I(){var a=
h();0==a.isPod&&0<a.podId&&c.getJSON(window.localUrl,{r:"callback/product-info",productId:a.podId,isCatalog:0,shopId:0},function(a){if(""===a.errMsg)if(1==a.data.spu.status||7==a.data.spu.status)c("#pod_buy_button").remove();else{var g=a.data;a=g.spu.promotion;var d=c("#pod-price");"p230"in a?(d.html(a.p230.price.directPrice),setTimeout(function(){d.html(g.spu.price.salePrice)},a.p230.endTime-prodDCutil.time.getServerTime())):"p102"in a?(d.html(a.p102.price.directPrice),setTimeout(function(){d.html(eBookInfo.spu.price.salePrice)},
a.p102.endTime-prodDCutil.time.getServerTime())):d.html(g.spu.price.salePrice)}})}function r(a){a=Number(a);a=(100*a).toFixed(0);a/=100;1E3>a?a=a.toFixed(2):1E3<=a&&(a=parseFloat(a.toFixed(2)));return a}function J(){var a=h(),b=c("#virtual-prd");1>a.isVirtualProduct||0==b.length||(l(a.price.salePrice,"套餐价"),4<b.find(".J-list li").length&&(b.find(".tab > li").off().click(function(){c(this).siblings("li").removeClass("now");c(this).addClass("now")}),b.find(".prev").off().click(function(){if(!c(this).hasClass("btn_none")){var a=
b.find(".tab > li.now"),d=a.index()-3;a.removeClass("now");b.find(".tab > :nth-child("+d+")").addClass("now")}}),b.find(".next").off().click(function(){if(!c(this).hasClass("btn_none")){var a=b.find(".tab > li.now"),d=a.index()+5;a.removeClass("now");b.find(".tab > :nth-child("+d+")").addClass("now")}}),b.find(".J-list").jCarouselLite({btnPrev:"#virtual-prd .prev",btnNext:"#virtual-prd .next",visible:4,scroll:4,circular:!1,disabledStyle:"btn_none",speed:50,btnGo:b.find(".tab > li")})),b.find(".J-list li").show())}
function l(a,b){u=a;var g="";0===~~h().price.originalPrice?k.hide():(p=Math.ceil(100*u/h().price.originalPrice*10)/100,10<=p?k.hide():k.show(),g=1>p?"小于1":p);a=r(a);K.html('<span class="yen">&yen;</span>'+a);c("#dd-price-text").text(b);0<k.length&&""!==g&&!m?k.html("("+g+"折)"):0<k.length&&k.html("");c("#buyarea_price").html(b+':<span class="price_d">&yen;'+a+"</span>");g=c("#original-price");0<g.length&&g.html('<span class="yen">&yen;</span>'+h().price.originalPrice);return!0}function L(){showMsgBox("loginAction",
"","",function(){c("body").trigger("renderAfterLogin")})}function M(a,b){var g=c("#points-tag"),d=0,f=h().price.points;b=c.extend({},{isPromo:!1},b);b.isPromo&&g.hide();if(void 0===e||0>=e.userType)d=f.p2;else{var k="p"+e.userType;k in f&&(d=f[k])}g.find("a").text(d)}function y(){void 0===e&&(c.getJSON(window.localUrl,{r:"callback/vip-info",shopId:h().shopId},function(a){""===a.errMsg&&(e=a.data,c("body").trigger("updatePromo").trigger("initOperation"))}),e={userType:-2,userShopType:[]});return e}
function N(){if(void 0===e||-2==e.userType)e=void 0,y()}function B(a,b,c){if(1===c||2===c){if(0==C){if(parseFloat(a.salePrice)<parseFloat(b.directPrice))return{type:-1}}else if(parseFloat(D)<=parseFloat(b.directPrice))return{type:-1};if(void 0!==e&&0<e.userType&&1===~~a.isVipPrice&&(c="p"+e.userType,a.vipPrice[c]<parseFloat(b.directPrice)))return{type:-1};D=b.directPrice}C=!0;return void 0===e?(y(),{type:0,price:b.directPrice}):"vipPrice"in b&&0<e.userType&&1===~~a.isVipDiscount?(c="p"+e.userType,
{price:b.vipPrice[c],level:e.userType,vipType:"dang",type:1}):1===~~a.shopVip&&"shopVip"in e.userShopType?{price:b.directPrice*e.userShopType.discount/10,level:e.userShopType.shopVip,vipType:"shop",type:1}:{type:0,price:b.directPrice}}function O(a,b){var e=!1,d=h().price;switch(b.type){case "mobile":e=H(b.data);break;case "preSalePrice":d=B(d,b.price,0);0===d.type?(c("#dd-vip").hide(),l(d.price,b.data.text)):(l(d.price,"VIP价"),w(d.vipType));break;case "a88":case "a90":case "p102":case "p228":case "p230":d=
-1!=c.inArray(b.type,["a88","a90"])?B(d,b.data.price,1):B(d,b.data.price,2),-1!==d.type&&(0===d.type?(c("#dd-vip").hide(),l(d.price,b.data.text)):(l(d.price,"VIP价"),w(d.vipType)),z(b.data.countDown),e=!0)}!e&&"failedCallback"in b&&b.failedCallback()}function P(){c("#pc-price").find(".mingxi").hover(function(){c(this).toggleClass("mingxi_hover");var a=c(this).position().left,b=c(this).width(),e=c(this).find(".mingxi_pop").width();a+b-20>=e?c(this).find(".mingxi_pop").attr("style",""):c(this).find(".mingxi_pop").css({left:-a})});
(function(){function a(a,b){f.siblings("span").removeClass().addClass(a).html("<i></i>"+b).show()}var b=c("#eBook-download"),e=c("#eBook-pop"),d=e.find("input"),f=d.siblings("a"),h=!1,k=/^1[34578]+\d{9}$/;e.appendTo("body");b.click(function(){h||(d.prop("value","输入您的手机号码"),d.removeClass(),f.siblings("span").hide().html(""),e.show(),h=!0)});e.find(".close").click(function(){e.hide();h=!1});d.focusin(function(){"输入您的手机号码"===d.val()&&d.val("");d.removeClass();f.siblings("span").hide().html("")}).focusout(function(){""===
d.val()?d.val("输入您的手机号码"):k.test(d.val())||a("hint","手机格式不正确，请重新输入")});f.click(function(){var b=d.val();if(k.test(b)){if(d.removeClass(),f.siblings("span").hide(),void 0===c(this).attr("class")){f.addClass("error");var e=60,g=setInterval(function(){f.text(""+e+"S后重试");e--;0===e&&(clearInterval(g),f.text("发送下载链接").removeAttr("class"),f.siblings("span").hide().html(""))},1E3);c.get(window.localUrl,{r:"callback/send-message",mobileNumber:b},function(b){"0"!==b?a("hint","发送失败"):a("success","发送成功，请检查您的手机")})}}else a("hint",
"手机格式不正确，请重新输入"),d.addClass("error")})})()}function G(){void 0!==q&&clearInterval(q);c("#mobile-price, #dd-vip").hide();c("#duration-time").parent().hide();var a=h().price.salePrice;l(a,"当当价");C=!1;D=void 0;J();E();if(!m){var a=h().price,b;void 0===e?y():1===~~a.isVipPrice||1===~~a.isVipDiscount?0<e.userType&&(b=a.vipPrice["p"+e.userType],parseFloat(b)<t()&&(l(a.vipPrice["p"+e.userType],"VIP价"),w("dang"))):"shopVip"in e.userShopType&&1===~~a.shopVip&&10>e.userShopType.discount&&(b=e.userShopType.discount*
a.salePrice/10,parseFloat(b)<t()&&(l(b,"VIP价"),w("shop")))}}var n={},K=c("#dd-price"),k=c("#dd-zhe"),u=-1,C=!1,D=void 0,p=-1,e,q,m=!1,x=!1;n.getFinalDiscount=function(){return-1===p?Math.ceil(1E3*h().price.salePrice/h().price.originalPrice)/1E3:p};n.getFinalPrice=t;n.getVipInfo=y;n.formatPrice=r;n.getPreSaleType=function(){return m?1:x?0:-1};n.init=function(){1!==~~h().isPresent&&(c("body").on("updatePrice",O).on("initPrice",G).on("loginAction",L).on("updatePoints",M).on("updatePreSalePrice",E).on("renderAfterLogin",
N),P(),G(),F(),I())};return n}(jQuery);
var geo=function(f){function w(){return{productId:item.base.productId,isRegionPromo:"promotion"in item&&"p228"in item.promotion,stockStatus:item.stock.stockStatus,shopId:item.base.shopId,templateId:item.base.templateId,isPresent:item.base.isPresent,isWireless:item.base.isWireless,isPod:item.base.isPod}}function z(){var d="",d=Cookie.Get("dest_area"),c=["province","city","district","town"];this.country={id:9E3,name:"中国"};this.province={id:-1,name:""};this.city={id:-1,name:""};this.district={id:-1,
name:""};this.town={id:-1,name:""};if(void 0!=d&&0!==d.length){for(var d=d.split("&"),g=!1,a=0;a<d.length;a++){var b=d[a].split("=");"0"===b[1]&&(b[1]=-1);var e=f.trim(b[0]).slice(0,-3);g?this[e].id=-1:(this[e].id=f.trim(b[1]),-1===parseInt(b[1])&&(g=!0))}for(a=1;a<c.length;a++)if(e=c[a],this[e].id==this[c[a-1]].id||-1==this[c[a-1]])this[e].id=-1}this.getLastAddress=function(){var l=c.length-1;do{var b=c[l];if(-1!=this[b].id)return this[b].id}while(0<=--l);return-1};this.getFourLevelAddress=function(){var l=
c.length-1,l=3==l?2:l;do{var b=c[l];if(-1!=this[b].id)return this[b].id}while(0<=--l);return-1};this.updateAddress=function(b){var a,d=!0;f(k).html("");for(var e=0;e<c.length;e++)a=c[e],void 0!==b[a]&&d&&-1!=b[a].id?(this[a].name=b[a].name,this[a].id=b[a].id,f(k).append("<li><a href='javascript:;'>"+b[a].name+"</a>")):d=!1};this.clearAddress=function(b){for(b+=1;b<c.length;b++)void 0!==c[b]&&(this[c[b]].id=-1,this[c[b]].name="")};this.getKey=function(b){return-1===b?"country":c[b]};this.getIdx=function(b){for(var a=
0;a<c.length;a++)if(b==c[a])return a};this.setAreaCookie=function(){initCookie.setAreaCookie("country_id="+this.country.id+"&province_id="+this.province.id+"&city_id="+this.city.id+"&district_id="+this.district.id+"&town_id="+this.town.id,2)}}function x(d){var c=[1,14,401,3],e="";if(-1!==f.inArray(~~d.province.id,[172,173]))return d.city.name;e+=d.province.name;e=void 0!==d.city&&-1==f.inArray(~~d.city.id,c)?e+d.city.name:d.city.name;if(void 0!==d.district)e+=d.district.name;else return e;void 0!==
d.town&&(e+=d.town.name);return e}function r(){var d=w();freight.clear();y.clear();f.getJSON(window.localUrl,{r:"callback/transfer",productId:d.productId,isRegionPromo:d.isRegionPromo?1:0,shopId:d.shopId,customAddress:t?1:0,stockStatus:1==d.isPod?"podStock":d.stockStatus,templateId:d.templateId,provinceId:e.province.id,cityId:e.city.id,districtId:e.district.id,townId:e.town.id,areaId:e.getFourLevelAddress()},function(c){if(""===c.errMsg){c=c.data;p.stockType=c.stockType;"wareHouseId"in c&&(p.wareHouseId=
c.wareHouseId,p.isLocalStore=c.isLocalStore);c.hasOwnProperty("deliveryAddress")&&f("#shop-geo-name").text(f.trim(c.deliveryAddress)+" 至");1==t&&(m.text(x(c.address)),e.updateAddress(c.address),h=f.extend(!0,{},e),k.find(">li:last").click());var g="",a={realStock:"有货",noStock:"缺货",preSale:"可预订",podStock:"无现货，随时可以为您单印一本"};c.stockType in a&&(g=a[c.stockType]);"noStock"==c.stockType&&0<d.isWireless||u.find(">div>b").text(g);f("body").trigger("updatePromo").trigger("initOperation");"noStock"==c.stockType&&
0<d.isWireless&&u.find(">div>b").text("");"noStock"==c.stockType||"podStock"==c.stockType?f("#deposit-send-date").html(""):y.get(d.shopId,d.productId,c.wareHouseId,c.type,c.srcWarehouseId);freight.set(d.shopId,e.getLastAddress(),d.templateId,1)}})}function A(){function d(a){var b=k.find(">li");b.removeClass("choose");b.length==a&&(b.parent().append("<li><a href='javascript:;'></a></li>"),b=k.find(">li"));b[a].className="choose";f(g).hide();f(g[a]).show()}var c=f("#geo-pop"),g=c.find(">ul").not(".tab");
f(document).on("click",function(a){if(0!=c.length&&"none"!=c.css("display")){var b=["geo-pop > ul","geo-name"],e=b.length-1,d=!0;a=a?a:window.event;var h=a.srcElement||a.target;do{var g=f("#"+b[e]),k=h;if(0<g.length)for(;d&&null!=k&&"undefined"!=typeof k.tagName;){for(a=0;d&&a<g.length;a++)k.outerHTML===f(g[a]).prop("outerHTML")&&(d=!1);k=k.parentElement}if(!1===d)return}while(e--);c.hide();m.removeClass("text_hover")}});m.on("click",function(){m.addClass("text_hover");c.show()});k.on("click",">li",
function(){var a=f(this).index(),b=f(g[a]),c=h[h.getKey(a-1)].id;d(a);c!=b.data("areaId")||0===b.text().length?f.getJSON(window.localUrl,{r:"callback/get-geography",areaId:c},function(a){if(""===a.errMsg){a=a.data;var d="",e;for(e in a.geography)d+="<li data-gid='"+e.substr(1)+"'><a href='javascript:;'>"+a.geography[e]+"</a></li>";"b"==a.style?b.addClass("list_notaligned"):b.removeClass("list_notaligned");0<b.length&&b.html(d);b.data("areaId",c)}}):1==b.find("> li").length&&b.find("> li").click()});
g.off("click").on("click","> li",function(){var a=f(this).data("gid"),b=h.getIdx(f(this).parent().data("list-name"));if("80000"==a)return!1;h[h.getKey(b)].id=a;h[h.getKey(b)].name=f(this).text();var n=e.getLastAddress();if(a==e[e.getKey(b)].id&&n!=a)k.find("li:eq("+(b+1)+")").click();else if(3==b&&e.getLastAddress()==a)c.hide(),m.removeClass("text_hover");else{var l=f(g[b+1]);f.getJSON(window.localUrl,{r:"callback/get-geography",areaId:a},function(a){if(""===a.errMsg)if(a=a.data,h.clearAddress(b),
k.find(">li:gt("+(b+1)+")").remove(),k.find(">li:eq("+b+") > a").text(h[h.getKey(b)].name),0===a.geography.length)t=!1,u.find(">div>b").text(""),f.extend(!0,e,h),r(),m.text(x(h)),e.updateAddress(h),"undefined"!=typeof initCookie&&e.setAreaCookie(),c.hide(),m.removeClass("text_hover"),d(b);else{var g="",n;for(n in a.geography)g+="<li data-gid='"+n.substr(1)+"'><a href='javascript:;'>"+a.geography[n]+"</a></li>";"b"==a.style?l.addClass("list_notaligned"):l.removeClass("list_notaligned");l.html(g);d(b+
1);h.clearAddress(b);k.find(">li:eq("+(b+1)+") > a").text("请选择");1==l.find("> li").length&&l.find("> li").click()}})}})}var k=f("#geo-pop-name"),e=null,h=null,u=f("#geo-info"),m=f("#geo-name"),t=!0,p={stockType:"noStock",wareHouseId:"-1",isLocalStore:"-1"},q={},v=f("#arrive-time"),y={clear:function(){v.html("")},get:function(d,c,g,a,b){""===v.html()&&f.getJSON(window.localUrl,{r:"callback/get-promise",shopId:d,productId:c,warehouseId:g,stockType:a,srcWarehouseId:b,provinceId:e.province.id,cityId:e.city.id,
districtId:e.district.id,townId:e.town.id},function(a){""==a.errMsg&&""!=a.data&&(v.html(a.data),0<f("#deposit-send-date").length&&(a.data=a.data.replace(/<(\/)?b>|&nbsp;/g,""),f("#deposit-send-date").html(a.data).show()))})}};q.stockInfo=function(){return p};q.getGeoInfo=function(){return e};q.init=function(){e=h=new z;1!==~~w().isPresent&&(f("body").on("updateStock",r),A(),r())};return q}(jQuery);
var detail=function(a){function d(){return{productId:item.base.productId,templateType:item.base.template,shopId:item.base.shopId,categoryPath:item.base.categoryPath,describeMap:item.base.describeMap,spuId:item.base.mainProductId,isPod:item.base.isPod,podId:item.base.podId}}function q(b){var e=b.target||b.srcElement;b=a(e).attr("id").substring(0,a(e).attr("id").indexOf("_"));a(e).addClass("hover").siblings().removeClass("hover");"detail"==b?(a(e).parents(".t_box").find("div[id$='_all']").show(),a("#price-explain").show()):
("1"!=a(e).attr("isload")&&("comment"==b?comment.init():"question"==b?question.init():a("#"+b+"_all").load(window.localUrl+"?r=callback/special-tabs&productId="+d().productId+"&tabId="+b+"&isSpec="+a(e).data("is-spec"))),a(e).parents(".t_box").find("div[id$='_all']").hide(),a("#"+b+"_all").show(),a("#price-explain").hide());e=a("#"+b+"_all").offset().top;e=a.support.leadingWhitespace?"detail"==b?e-5:e:"detail"==b?e-22:e-10;f.hasClass("tab_panel_fixed")&&p&&a("html,body").animate({scrollTop:e},100)}
function v(){0<g.length&&function(){var b=3;isWidth?"publish"!==d().templateType&&(b=4):b=2;var e=g.find(".list > div > ul > li"),c=e.length;a.each(e,function(c,e){var h="w_";isWidth||(h="n_");h=h+Math.floor(c/b)+"_"+Math.floor(c%b);a(e).attr("ddt-pit",h)});if(c>b){if(0<c%b){for(var e=b-c%b,c="",h=0;h<e;h++)c+="<li></li>";g.find(".list > div > ul").append(c)}g.find(".list > .next").removeClass("btn_none");g.find(".list > div").jCarouselLite({btnNext:"#virtual-detail .list > .next",btnPrev:"#virtual-detail .list > .prev",
visible:b,scroll:b,circular:!1,disabledStyle:"btn_none"})}else g.find(".list > .btn_a").hide(),g.find(".list > div > ul.clearfix > li:first > div.add").remove()}()}function r(){if(!(0<a(this).prop("src").indexOf("grey"))){"1"==a(this).attr("isModify")&&(a(this).css({width:"auto",height:"auto"}),a(this).removeAttr("isModify"));var b=900;"publish"==d().templateType&&(b=800);isWidth||(b=700);if(this.width>b){var e=b/this.width*this.height;a(this).css({width:b,height:e})}}}function t(b){k.html(b);k.find("img").each(function(b,
c){c=a(c);void 0!=c.attr("href")&&void 0==c.attr("width")&&void 0==c.attr("height")&&a(c).css({width:200,height:200}).attr("isModify","1")});k.find("img").ddlazyload({appear:1}).on("load",r);k.find("a[id*='-btn']").on("click",function(){var b=a(this).attr("id").replace("-btn",""),c=a("#"+b+"-textarea"),h=a("#"+b+"-show"),d=a("#"+b+"-show-all");if(0<c.length){var f=c.val();c.remove();d.html(f.replace(/\n/g,"").replace(/font-size.+?;/ig,""))}c="";"none"==d.css("display")?(c="显示部分信息",a(this).attr("dd_name",
c).text(c),h.hide(),d.show()):(c="显示全部信息",a(this).attr("dd_name",c).text(c),h.show(),d.hide());if("attachImage"==b)d.find("img").ddlazyload({appear:1}).on("load",r)});(function(){var b=a("#extract"),c=a("#read-online");0>=b.length||0>=c.length||(c.show(),c.removeAttr("target"),c.click(function(){var c=0,d=setInterval(function(){var f=b.offset().top-a("#tab-panels").height();c==f?clearInterval(d):(c=f,a("html,body").scrollTop(f))},15)}))})()}function w(){var b=n.find("ul").clone(),e=f.find("ul").clone();
a(window).scroll(function(){var c;c=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;var d=a("#review_point").offset(),l=a("#operation-fix"),g=l.offset(),m=a("#button_endpoint").offset().top;c>m?(f.addClass("tab_panel_fixed").show(),l.hide(),c>d.top?(l.show(),p||(b=n.find("ul").clone(),f.find("ul").html(b.html()),n.find("ul").html(e.html()),f.find("li[id*='_tab']").off("click").on("click",q),p=!0)):(f.find(".live800").html(a("#live800").parent().html()).find("#live800").html('<a href="javascript:void(0)" title="点此与客服交流">联系商家</a>'),
p&&(b=f.find("ul").clone(),f.find("ul").html(e.html()),n.find("ul").html(b.html()),n.find("li[id*='_tab']").off("click").on("click",q),p=!1))):(l.hide(),f.removeClass("tab_panel_fixed").hide());m=a("#navigation-labels");d=m.find("> .hover");d=0==a(d).length?c:a(d).offset().top;c=m.find("> [data-idx]").removeClass("hover");for(var k=0;k<c.length;k++)if(m="#"+a(c[k]).data("idx"),a(m).offset().top<=d&&a(m).offset().top+a(m).height()>d){a(c[k]).addClass("hover");break}0<c.length?(a(c[0]).data("idx"),
d="#"+a(c[c.length-1]).data("idx"),a(d).offset().top+a(d).height()<g.top+l.height()&&l.hide()):a("#detail").offset().top+a("#detail").height()<g.top+l.height()&&l.hide()})}var k=a("#detail"),u={},f=a("#tab-panels"),n=a("#tab-panels2"),g=a("#virtual-detail"),p=!1;n.find("li[id*='_tab']").on("click",q);u.init=function(){"publish"==d().templateType?a.getJSON(window.localUrl,{r:"callback/detail",productId:1==d().isPod&&0<d().podId?d().podId:d().productId,templateType:d().templateType,describeMap:d().describeMap,
shopId:d().shopId,categoryPath:d().categoryPath},function(b){if(""==b.errMsg&&""!=b.data.html){if(isWidth){var d=a("#navigation-labels");d.html(juicer(a("#navigation-templates").html(),b.data)).show().parent()}t(b.data.html);if(isWidth)d.find("> li").on("click",function(){var b=a(this).data("idx");void 0!=b&&a("html,body").animate({scrollTop:a("#"+b).offset().top-f.height()},800)})}}):a.get(window.localUrl,{r:"callback/detail",productId:d().spuId,templateType:d().templateType,describeMap:d().describeMap,
shopId:d().shopId,categoryPath:d().categoryPath},function(a){""!=a&&t(a)});w();v()};return u}(jQuery);
var comment=function(){function l(){return{productId:item.base.mainProductId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId}}function q(){function d(){var e={};$(this).hasClass("current")?e.tagId=0:(e.tagId=$(this).data("tag-id"),$(this).parent().siblings().find("a.current").removeClass("current"),k.find("span").removeClass("on"));$(this).toggleClass("current");k.find("span:first").addClass("on");e.pageIndex=1;h(e)}return function(){var e=l();
$.getJSON(window.localUrl,{r:"callback/comment-label",productId:0<e.mainProductId?e.mainProductId:e.productId,categoryPath:e.categoryPath},function(a){if(""!=a.errMsg)c.html(juicer($("#comment_tags_tpl").html()).render({tags:[]}));else{a=juicer($("#comment_tags_tpl").html()).render(a.data);c.html(a);var b=c.find(".comment_tag_total");36<b.height()?(b.addClass("comment_tag_total_up"),b.find("> a").click(function(){b.toggleClass("comment_tag_total_up")})):c.find(".comment_tag_total > .up").hide();c.find("span > a").click(d)}})}()}
function n(){function d(a){var b=1;$(this).hasClass("active")||(a.data?"prev"==a.data.type?b=parseInt($("#comment_page a.on").text())-1:"next"==a.data.type&&(b=parseInt($("#comment_page a.on").text())+1):b=parseInt($(this).text()),h({pageIndex:b,pageClick:!0}))}function e(a){var b=$(this).parent().prev("ul.pic_show").find("li.on").index(),g=$(this).parent().prev("ul.pic_show").children().length;if("prev"==a.data.type&&0!=b)b--;else if("next"==a.data.type&&b!=g-1)b++;else return;$(this).parent().prev("ul.pic_show").find("li:eq("+
b+") a").click()}k.on("click","span",function(){var a={};$(this).hasClass("on")&&0==c.find("span > a.current").length||($(this).addClass("on").siblings().removeClass("on"),c.find("div.comment_tag_total > span > a").removeClass("current"),c.find("a.selected").removeClass("selected"),a.pageIndex=1,h(a))});f.find(".pl02").click(function(){$(this).parent().toggleClass(" comment_sort_hover")});f.find("ul > li > a").click(function(){f.find(".pl02").text($(this).text());f.toggleClass(" comment_sort_hover");
h({pageIndex:1})});$(document).click(function(a){if(f.hasClass("comment_sort_hover")){a=a?a:window.event;a=a.srcElement||a.target;for(var b=$("#comment_sort"),g=!0;null!=a&&"undefined"!=typeof a.tagName;)a.outerHTML===b.prop("outerHTML")&&(g=!1),a=a.parentElement;g&&f.removeClass("comment_sort_hover")}});m.on("click","#comment_page div > a.J-num",d).on("click","#comment_page a.back",{type:"prev"},d).on("click","#comment_page a.next",{type:"next"},d);m.on("click",".J-show_all_comment",function(){var a=
$(this),b=a.prev("span"),g=b.html();b.html(a.next("textarea").html());a.next("textarea").html(g);a.find("i").hasClass("up")?a.html("展开评论<i ></i>"):a.html('收起评论<i class="up"></i>')}).on("click","ul.pic_show a",function(){var a=$(this);m.find(">.item_wrap").find(".pic_show_big").hide();var b=a.parent().parent().next(".pic_show_big");a.parent().hasClass("on")?(b.hide(),a.parent("li").removeClass("on")):(b.find("img").attr("src",a.find("img").data("big-pic")).end().show(),m.find(">.item_wrap").find("li").removeClass("on"),
a.parent("li").addClass("on"));b=a.parent().parent().siblings(".pic_show_big").find(".big_pic_left");0==a.parent().index()?b.hide():b.show();b=a.parent().parent().siblings(".pic_show_big").find(".big_pic_right");a.parent().index()==a.parent().parent().find("li").length-1?b.hide():b.show()}).on("click","span.big_pic_left",{type:"prev"},e).on("click","span.big_pic_right",{type:"next"},e).on("click",".pic_show_big img",function(){$(this).parent().parent().prev().find(".on").removeClass("on");$(this).parent().parent().hide()}).on("mouseover",
"ul.pic_show li",function(){$(this).addClass("hover")}).on("mouseout","ul.pic_show li",function(){$(this).removeClass("hover")});n=function(){}}function h(d){function e(a,b){function e(a,b){var c=220,g,c=1.8;b||(a=100==a?99.999:a,c=0);if(0!=a)return b?(g=220+c,c=220+3.6*a-c):(g=220-3.6*a+c,c=220-c),c=c*Math.PI/180,g=g*Math.PI/180,["M"+(57+54*Math.sin(c)),57-54*Math.cos(c)+"A54",54,0,50.5<a?1:0,0,57+54*Math.sin(g),57-54*Math.cos(g)].join()}var d=$("#comment_percent"),c=$("#comment-percent"),f="";a=
100==a||0==a||0===a%1?parseInt(a):parseFloat(a).toFixed(1);d.html(a+"<i>%</i>");0==a?(f="processingbar4",b&&(f="processingbar3 processingbar3_none"),c.hide()):(f=60>a?"processingbar3":85<a?"processingbar":"processingbar2",c.show());c.parent().removeClass().addClass(f);c.find("#J-deep").attr("d",e(a,!1));c.find("#J-light").attr("d",e(100-a,!0))}var a=!1;void 0!=d&&"pageClick"in d&&(a=!0,delete d.pageClick);var b=$.extend(function(){var a=0,b=1,e=0,d=c.find("a.current");0<d.length&&(a=d.data("tag-id"),
e=d.data("tag-num"));"时间排序"==f.find(".pl02").text()&&(b=2);var d=k.find("span.on").data("type"),h=1;1!=d&&2!=d&&(h=0);return{r:"callback/comment-list",productId:l().productId,categoryPath:l().categoryPath,mainProductId:l().mainProductId,mediumId:l().mediumId,pageIndex:1,sortType:b,filterType:d,isSystem:h,tagId:a,tagFilterCount:e}}(),d);$.ajax({url:window.localUrl,type:"GET",dataType:"JSON",data:b,success:function(c){if(""==c.errMsg){if(1==b.pageIndex&&c.data.summary){var d=c.data.summary,f=k.find("span");
$(f[0]).html("全部（"+d.total_comment_num+"）");$(f[1]).html("好评（"+d.total_crazy_count+"）");$(f[2]).html("中评（"+d.total_indifferent_count+"）");$(f[3]).html("差评（"+d.total_detest_count+"）");$(f[4]).html("晒图（"+d.total_image_count+"）");e(d.goodRate,0<d.total_comment_num);$("#comment_total_num_title, #comm_num_down").html(d.total_comment_num);$("#comment_tab").html("商品评论("+d.total_comment_num+")")}m.html(c.data.html);a&&$("html,body").animate({scrollTop:$("#comment_all").offset().top-45},0)}}})}var p={},k=
$("#comment_num_tab"),c=$("#comment_tags_div"),f=$("#comment_sort"),m=$("#comment_list");0<$("#comm_num_down").length&&$("#comm_num_down").click(function(){$("html,body").animate({scrollTop:$("#comment_point").offset().top},0);$("#comment_tab").click()});p.init=function(){n();q();h();k.attr("isload","1")};return p}();
var question=function(){function b(){return{productId:item.base.productId,templateType:item.base.template,shopId:item.base.shopId,categoryPath:item.base.categoryPath,describeMap:item.base.describeMap,mainProductId:item.base.mainProductId}}function d(a){var c={r:"callback/question-list",productId:0<b().mainProductId?b().mainProductId:b().productId,templateType:b().templateType,pageIndex:1};a&&(c=$.extend(c,a));$.ajax({type:"GET",url:window.localUrl,data:c,success:function(a){$("#question_all").html(a);
$("#question_tab").html("商品问答("+$("#question_total_count").text()+")")}})}function e(){qid=$(this).attr("id").replace("question_answer_","");showMsgBox($(this).attr("id"),"","",function(){window.location.href="http://comm.dangdang.com/question/questiondetail.php?question_id="+qid});return!1}function f(){var a=b().productId;showMsgBox("question_new","","",function(){window.location.href="http://comm.dangdang.com/question/question.php?product_id="+a});return!1}return{init:function(){d();$("#question_tab").attr("isload",
"1");$("#question_all").on("click","[id^='question_answer_']",e).on("click","#question_new",f)},questionSlide:function(a){var c={},b=$("#question_page").find("a.on").text();$(a).hasClass("next")?c.pageIndex=~~b+1:$(a).hasClass("back")?c.pageIndex=~~b-1:c.pageIndex=$(a).text();d(c)}}}(jQuery);
var promotion=function(d){function B(){var a=price.getVipInfo();if(void 0===a||0<=a.userType)return"";a=n().price;return"1"==a.isVipDiscount&&c.hasPromo("vipDiscount")||"1"==a.isVipPrice&&c.hasPromo("vipPrice")?'<div class="clearfix" data-promotype="login"><b>VIP优惠</b><div class="rule rule04"><p><span class="text"><a href="javascript:;">登录</a>后确认是否享有此优惠 </span></p></div></div>':"1"==a.shopVip&&c.hasPromo("shopVip")?'<div class="clearfix" data-promotype="login"><b>店铺VIP</b><div class="rule rule04"><p><span class="text"><a href="javascript:;">登录</a>后确认是否享有此优惠 </span></p></div></div>':
""}function z(a){if(0<w.length)return w[a];var b=d("#promo-template").find("> script");if(0!=b.length)return d.each(b,function(a,b){for(var e=(""+d(b).data("promoid")).split("-"),p=0;p<e.length;p++)w["p"+e[p]]=d(b)}),w[a].html()}function v(a){for(var b=d("#promo-list").find(">div"),c=0;c<b.length;c++)if(a==d(b[c]).data("promotype"))return d(b[c])}function C(){var a=n(),b=d.extend(!0,{},a.promotion),h=d("body");h.trigger("initPromo").trigger("initPrice").trigger("initBuyNumber");switch(price.getPreSaleType()){case 0:c.on("ordinaryPreSale");
break;case 1:c.on("depositPreSale"),c.offAllPromo(["activity","promotion","mobilePrice"]),c.off("vipPrice","vipDiscount","shopVip"),0<a.preSale.limitBuyNum&&m.set({type:"depositPreSale",max_limit_number:a.preSale.limitBuyNum})}D(b);c.hasPromo("mobilePrice")&&r.mobilePrice();a:if(0!=d("#main-image-icon").length){n();var a=[230,102,228,1,201,20,23,205,206,207,225,12,14,28,3,30,229,5,51],f=0;mainImg.icon.unset();if(0!=item.base.icon.length&&"flash"==item.base.icon.type)mainImg.icon.set(item.base.icon,
"flash");else if(c.hasPromo("ordinaryPreSale"))mainImg.icon.set(item.attachInfo.iconTable.preSale,"");else if(c.hasPromo("depositPreSale"))mainImg.icon.set(item.attachInfo.iconTable.preSaleDeposit,"");else if(c.hasPromo("a90"))mainImg.icon.set(item.attachInfo.iconTable.a90,"");else if(c.hasPromo("a88"))mainImg.icon.set(item.attachInfo.iconTable.a88,"");else{for(f=0;f<a.length;f++){var e="p"+a[f];if(e in item.promotion&&c.hasPromo(e)){mainImg.icon.set(item.attachInfo.iconTable["p"+a[f]],"",a[f]);break a}}0!=
item.base.icon.length?mainImg.icon.set(item.base.icon,""):c.hasPromo("mobilePrice")&&mainImg.icon.set(item.attachInfo.iconTable.mobilePrice,"")}}if(c.hasPromo("p225"))r.p225.on(b.p225);else r.p225.off();c.hasPromo("p229")&&r.p229(v("229"));c.hasPromo("p28")&&r.p3_28(v("28"));c.hasPromo("p3")&&r.p3_28(v("3"));r.loginAction();h.trigger("updatePoints",[{isPromo:c.hasPromo()}]);b=m.get();void 0!=b&&prodBuyNumber.setBuyNumber(b)}function D(a){var b=n();d.each(["p230","a88","a90","p102","p228"],function(g,
d){if(c.hasPromo(d))if("a"===d.substr(0,1))u["activity"+d.substr(1)](b.activity);else d in a&&u["promotion"+d.substr(1)](a[d])});var h=!1;d.each(["p228","p102","a90","a88","p230"],function(a,g){h&&c.off(g);c.hasPromo(g)&&(h=!0)});c.hasPromo("a88")||d("#bread-crumb-outlets").hide();0==n().shopId&&c.hasPromo("a88","a90")&&(c.off("p5","p51"),c.off("p1"),c.off("p3","p28","p229"),c.off("p20","p22","p23","p201","p205","p206","p207","p225","p226"));"p51"in a&&u.promotion51(a.p51);var f=[229],f=f.concat([1,
5]),f=f.concat([20,23,205,206,207,201]),f=f.concat([12,14]),f=f.concat([3,28,30]),e=[3,28],p=B();if(0!==x.length){for(var k=0;k<f.length;k++){var l="p"+f[k];if(c.hasPromo(l)&&l in a){var g=a[l];g.rule="";g.ddtArea="";g.promoType=f[k];switch(f[k]){case 1:var q=u.promotion1(g);g.text=q.text;g.rule="rule05";""!=q.title&&(g.title=q.title,g.rule="rule06");break;case 3:g.selectText="选赠品";g.rule="rule02";g.ddtArea="024";g.text=1==g.isAutoEBook?"购买本纸质书可赠送以下任意一本电子书":"购买本商品可赠送以下任意一件商品";g.isMarkup=0;g.len=Math.ceil(g.gifts.length/
3);g.width=3;break;case 5:q=m.get();if(void 0!=q&&"max_limit_number"in q&&1E4>~~q.max_limit_number)continue;g.rule="rule03";m.set({max_limit_number:g.limitNumber,type:l});break;case 201:g.rule="rule03";g.ddtArea="026";m.set({max_limit_number:g.limitNumber,type:l});break;case 12:g.rule="rule05";break;case 14:g.rule="rule06";break;case 20:g.rule="rule04";m.set({max_limit_number:g.limitNumber,type:l});break;case 28:g.selectText="选购商品";g.rule="rule03";g.ddtArea="028";g.text="购买本商品可加价换购以下任意一件商品";g.isMarkup=
1;g.len=Math.ceil(g.gifts.length/2);g.width=2;break;case 229:g.rule="rule06";g.ddtArea="025";g.title="电子书加价购";break;case 207:m.set({max_limit_number:g.limitNumber,type:l});break;case 205:g.rule="rule01";m.set({max_limit_number:g.limitNumber,type:l});break;case 206:case 23:g.rule="rule04",m.set({max_limit_number:g.limitNumber,type:l})}for(q=0;q<e.length;q++)if(f[k]==e[q]){var A=g.width,t;for(t in g.gifts)g.gifts[t].ddtPit=Math.floor(t/A)+"_"+Math.floor(t%A)}p+=juicer(z(l),g)}}""!==p&&x.html(p).parent().show()}}
function E(){var a=n(),b=d.extend(!0,{},a.preSale);if(1==b.isPreSale&&0!=b.type){var c=d("#deposit_step"),f=0,e="";~~a.isCatalog&&"undefined"!=typeof prodSkuInfo&&d.each(prodSkuInfo,function(a,b){e+=","+b.itemId});d.getJSON(window.localUrl,{r:"callback/get-deposit-order",productId:a.productId,activityId:b.activityId,isCatelog:a.isCatalog,subProductIds:e.substr(1)},function(a){if(""===a.errMsg)if(f=b.startDate>prodDCutil.time.getServerTime()?0:a.data.orderCount,"2"==b.type&&1<b.rankNum){var e=0;c.find("li").each(function(a,
b){var c=parseInt(d(b).attr("rank_min_num"));e=a;if(0==a&&f<c||f==c)return!1;if(f<c)return e=--a,!1});c.find("li:lt("+~~(e+1)+")").addClass("deep");0<f&&c.find("li:eq("+e+")").find(".num").html("<b>已团"+f+"件</b>").show();a="";var l=e==b.rankNum?e:e+1;a=~~c.find("li:eq("+l+")").attr("rank_min_num");l=c.find("li:eq("+l+")").find(".price b").text().substr(1);a=0<a-f&&(2>=a-f||.2>=(a-f)/a)?"再定"+(a-f)+"件，就可以&yen;"+l+"购买，快邀好友拼团吧！":"总拼团件数越多，价格越低，快邀好友拼团吧！";d("#deposit_buy_button").parent().append('<span class="tuan">'+
a+"</span>");"nostock"==geo.stockInfo().stockType.toLowerCase()&&d("#deposit_buy_button").parent().find(".tuan").hide()}else"undefined"!=typeof b.rankMinNum&&F(b.rankMinNum,f)})}}function F(a,b){var c="";1<a&&(c='<span class="tuan">'+a+"人成团</span>");d(".buy_box_btn").append(c)}function G(){x.html("").parent().hide();"undefined"!=typeof mainImg&&mainImg.icon.unset();m.clear();var a=n();c.init();for(var b in a.promotion)c.on(b);"mobilePrice"in a.price?c.on("mobilePrice"):c.off("mobilePrice");"1"===
a.price.isVipDiscount?c.on("vipDiscount"):c.off("vipDiscount");"1"===a.price.shopVip?c.on("shopVip"):c.off("shopVip");"1"===a.price.isVipPrice?c.on("vipPrice"):c.off("vipPrice");if(void 0!=a.activity)c.on("a"+a.activity.type)}var y={},x=d("#promo-list"),w=[],n=function(){return{productId:item.base.productId,shopId:item.base.shopId,mainProductId:item.base.mainProductId,productName:item.base.productName,promotion:item.promotion,activity:"activity"in item?item.activity:void 0,price:item.price,isCatalog:item.base.isCatalog,
preSale:item.preSale,isPresent:item.base.isPresent,productType:item.base.productType}},c=function(){function a(){e={promotion:{},activity:{},preSale:!1,mobilePrice:!1}}function b(a,b){for(var d=0;d<a.length;d++){var g=a[d],f=c(g);f===g?e[g]=b:e[f][g]=b}}function c(a){return"p"===a.substr(0,1)&&0<parseInt(a.substr(1))?"promotion":"a"===a.substr(0,1)&&0<parseInt(a.substr(1))?"activity":a}function f(a){if(a in e)e[a]=!1;else for(var b in e[a])e[a].hasOwnProperty(b)&&(e[a][b]=!1)}var e={};a();return{on:function(a){var d=
[],d=a instanceof Array?a.slice(a,0):Array.prototype.slice.call(arguments);b(d,!0)},off:function(a){var d=[],d=a instanceof Array?a.slice(a,0):Array.prototype.slice.call(arguments);b(d,!1)},hasPromo:function(){var a=!1,b;if(0===arguments.length){a:{for(b in e.promotion)if(e.promotion.hasOwnProperty(b)&&e.promotion[b]){b=!0;break a}b=!1}return b}for(b=0;b<arguments.length;b++){var d;d=arguments[b];var g=c(d);d=g===d?e[d]:e[g][d];a|=d}return a},init:a,offAllPromo:function(a){a instanceof Array?d.each(a,
function(a,b){f(b)}):d.each(arguments,function(a,b){f(b)})}}}(),m=function(){var a={};return{set:function(b){a[b.type]=d.extend(!0,{},b)},get:function(){var b;d.each("p230 p102 p228 a88 a90 depositPreSale".split(" "),function(d,e){c.hasPromo(e)&&e in a&&!(a[e].hasOwnProperty("max_limit_number")&&1E4<=a[e].max_limit_number)&&(b=a[e])});if(void 0==b)if(c.hasPromo("p5")&&"p5"in a)b=a.p5;else if(c.hasPromo("p51")&&"p51"in a)b=a.p51;else for(var h in a)b=a[h];return b},clear:function(){a={}}}}(),u={promotion228:function(a){function b(a,
b){var e=a-f;0<e&&(c.on("p228"),d("body").trigger("updatePrice",[{type:"p228",data:{price:b,text:"抢购价",countDown:{durationTime:e}},failedCallback:function(){c.off("p228")}}]))}var h=geo.stockInfo(),f=prodDCutil.time.getServerTime(),e=geo.getGeoInfo().province.id,p=-1,k;if("realStock"!=h.stockType||1!=h.isLocalStore)c.off("p228");else{for(var l in a)if(!(a[l]instanceof Function)){if(void 0!=k)break;if(!(a[l].endTime<=f))for(h=0;h<a[l].dimension.length;h++)if(0<=d.inArray(""+e,a[l].dimension[h].region)&&
!(parseFloat(a[l].dimension[h].price.directPrice)>parseFloat(n().price.salePrice))){k=a[l].dimension[h];p=a[l].endTime;break}}void 0!=k?(b(p,k.price),c.hasPromo("p228")&&m.set({max_limit_number:k.limitNumber,type:"p228"})):c.off("p228")}},promotion102:function(a){var b=a.endTime-prodDCutil.time.getServerTime();0>b?(delete item.promotion.p102,c.off("p102")):(c.on("p102"),d("body").trigger("updatePrice",[{type:"p102",data:{price:a.price,text:"抢购价",countDown:{durationTime:b,promotion_more_url:"http://promo.dangdang.com/"+
a.promoId}},failedCallback:function(){c.off("p102")}}]),c.hasPromo("p102")&&m.set({max_limit_number:a.limitNumber,type:"p102"}))},promotion230:function(a){var b=a.endTime-prodDCutil.time.getServerTime();0>b?(delete item.promotion.p230,c.on("p102")):(c.on("p230"),d("body").trigger("updatePrice",[{type:"p230",data:{price:a.price,text:"秒杀价",countDown:{durationTime:b}},failedCallback:function(){c.off("p230")}}]),c.hasPromo("p230")&&m.set({max_limit_number:a.limitNumber,type:"p230"}))},promotion1:function(a){var b=
price.getVipInfo(),d=a.text.ordinary,f=n().price,e="多买多折",p=100;"1"==f.isVipDiscount&&0<~~b.userType&&(p=f.discount["d"+b.userType],e=b.name);void 0!==d&&"1"==f.shopVip&&"shopVip"in b.userShopType&&(p=10*b.userShopType.discount,e=b.userShopType.name);for(b=0;b<d.length;b++){var k=d[b],l;l=d[b].discount*f.salePrice/100;var g=p;void 0==g&&(g=100);l=Number(l*g);l=l.toFixed(0);l=parseFloat((l/100).toFixed(2));k.price=l}f='<p><span class="text">';for(b=0;b<d.length;b++){f+="购买满"+d[b].number+"件，享&yen;"+
d[b].price+"/件";if(d.length-1==b){f+='</span><a href="'+a.activityUrl+'" class="alink" target="_blank"  rel="nofollow">详情>></a></p>';break}f+=1==b%2?'</span></p><p><span class="text">':"；"}c.on("p1");c.off("mobilePrice");return{text:f,title:e}},promotion225:function(a,b){function h(a,b){b.hasOwnProperty(a)&&!d.isEmptyObject(b[a])?(b.currentId=a,f(b[a]),e(b[a])):b.hasOwnProperty(a)||(b[a]={},d.getJSON(window.localUrl,{r:"callback/get-promotion225-detail",promotionId:a,productId:n().productId,shopId:n().shopId,
productType:n().productType},function(d){""!=d.errMsg||0==d.data.length?c.off("p225"):(d=d.data,b[a]=d,b.currentId=a,f(d),e(d))}))}function f(a){var b=d("#buyPackage"),c=d("#buyTogether"),e=!1;0!=d.trim(c.text()).length&&(e=!0,0==b.find('ul.tab>li[data-type="buyPackage"]').length&&(c.find("ul.tab").prepend('<li data-type="buyPackage">优惠套餐</li>'),c.hide()));var c=[],f="";c.push('<ul class="tab clearfix">');c.push('<li class="hover" data-type="buyPackage">优惠套餐</li>');e&&c.push('<li data-type="buyTogether">拍档组合</li>');
c.push("</ul>");1==a.length&&(f='style="display:none"');c.push('<ul class="tab2">');for(e=1;e<=a.length&&9>=e;e++)c.push("<li "+f+">优惠套餐"+e+"</li>");c.push("</ul>");b.html(c.join("")).show()}function e(a){var b=d("#right-content").find(".group_buy:first");b.find(".tab2 > li").click(function(){var c=d(this).index(),e;d(this).siblings().removeClass("hover");d(this).addClass("hover");b.find(".over").remove();b.find(".group_info").remove();e=d.extend(!0,{},a[c]);e.index=c+1;var f,k=n(),h=d.extend(!0,
{},e),q=0;h.products=[];for(var m=0;m<e.products.length;m++)e.products[m].productId==k.productId||e.products[m].productId==k.mainProductId?(f=e.products[m],f.selectProductId=k.productId,f.price=k.price.salePrice,f.ddtPit=Math.floor(m/p)+"_"+Math.floor(m%p),h.products.unshift(f),q+=parseFloat(f.price)*f.number):(h.products.push(e.products[m]),q+=parseFloat(e.products[m].price)*e.products[m].number);h.totalDangPrice=price.formatPrice(q);h.productId=k.productId;h.titleText=d(this).text();h.width=p;h.ddtArea=
"027_"+c;c="w_";isWidth||(c="n_");for(e=0;e<h.products.length;e++)h.products[e].ddtPit=c+Math.floor(e/h.width)+"_"+Math.floor(e%h.width);b.find(".tab2").after(juicer(z("p225"),h));b.find("#promotion_buyButton").click(function(){recommend.addCart("promotion_lists",225)});h.products.length>p&&(b.find(".over > div").jCarouselLite({btnPrev:"#right-content > .group_buy:first .prev",btnNext:"#right-content > .group_buy:first .next",visible:p,scroll:p,circular:!1,disabledStyle:"btn_none"}),isWidth?b.find(".over > div").css("margin-left",
"-40px"):b.find(".over > div").css("margin-left","-20px"))});b.find(".tab2 > li:first").trigger("click");var c=d("#buyPackage"),e=d("#buyTogether");0<d.trim(e.text()).length&&(d("#buyTogether, #buyPackage").find("ul.tab > li").click(function(){"buyPackage"==d(this).data("type")?(c.show(),e.hide()):(c.hide(),e.show())}),c.show(),e.hide())}var p=isWidth?5:4,k;k=a.promoId instanceof Array?a.promoId.join(","):a.promoId;b.currentId!=k?h(k,b):e(b[k])},activity:function(a){if(void 0!==a.type){var b="";if(88===
~~a.type)b="尾品价";else if(90===~~a.type)b="值当价";else{c.off("a"+a.type);return}if(0>~~a.endTime-prodDCutil.time.getServerTime())c.off("a"+a.type);else{c.on("a"+a.type);var h={directPrice:a.price},f=n().price;1===~~f.isVipDiscount&&(h.vipPrice=d.extend(!0,{},f.vipPrice));d("body").trigger("updatePrice",[{type:"a"+a.type,data:{price:h,text:b,countDown:{durationTime:a.endTime-prodDCutil.time.getServerTime()}},failedCallback:function(){c.off("a"+a.type)}}]);c.hasPromo("a"+a.type)&&m.set({max_limit_number:a.limitNumber,
type:"a"+a.type})}}},activity88:function(a){u.activity(a);if(c.hasPromo("a88")){var b=d("#bread-crumb-outlets");b.find("a#olbp").attr("href",a.activityUrl);b.show().find("img.J-outlets-img").attr("src",isWidth?a.width:a.narrow);b.hover(function(){d(this).children(".o_banner,.o_close").fadeIn(100)},function(){d(this).children(".o_banner,.o_close").slideUp(100)});d(".outlets .o_close").click(function(){d(this).parents(".outlets").find(".o_banner,.o_close").slideUp()})}},activity90:function(a){u.activity(a)},
promotion51:function(a){c.hasPromo("p51")&&(m.set({min_limit_number:a.limitNumber,type:"p51"}),c.on("p51"))}},r=function(){var a=!0,b={},h=!0,f=[];return{p229:function(a){if("undefined"!=typeof a){var c="p"+a.data("promotype");a.find(".checkboxa").off("click").click(function(){d(this).toggleClass("checkboxa_nonce");var f=d(this).next().data("pid"),h=d(this).next().data("price");d(this).hasClass("checkboxa_nonce")?(a.data("select-pid",f),a.data("select-prd-price",h),b[c]={isSelect:!0}):(a.removeData("select-pid"),
a.removeData("select-prd-price"),delete b[c])});c in b&&a.find(".checkboxa").click()}},p3_28:function(c){if("undefined"!=typeof c){var f=c.data("promotype"),k="p"+f,l=c.find(".xuan_gou");k in b||(b[k]={isClose:0});c.find(".xuan_gou").off("click").click(function(){d(this).toggleClass("xuan_gou_hover");"收起"==d(this).text()?(d(this).text(d(this).data("text")),b[k].isClose=1):(d(this).data("text",d(this).text()),d(this).text("收起"),b[k].isClose=0);d(this).siblings("div").toggle("slow","linear")});k in
b&&1==b[k].isClose&&l.removeClass("xuan_gou_hover").text(l.data("text")).siblings("div").hide();var g=c.find(".tab"),m=c.find(".list");if(0==g.find("> li").length)g.siblings("a").hide();else{var n=g.siblings("a");m.hover(function(){n.toggle()});n.hover(function(){n.toggle()});var t=c.data("show-width");m.jCarouselLite({btnNext:n[1],btnPrev:n[0],btnGo:g.find("> li"),visible:parseInt(t),scroll:parseInt(t),start:0,stopAnimateOption:function(){return h},afterEnd:function(){h&&(b[k].pageIdx=g.find(".now").index())}});
d(n[1]).on("click",function(){var a=g.find("> li"),b=g.find("> .now"),c=b.index(),c=c>=a.length-t?0:c+t;b.removeClass("now");d(a[c]).addClass("now")});d(n[0]).on("click",function(){var a=g.find("> .now"),b=g.find("> li"),c=a.index(),c=0==c?b.length-t:c-t;a.removeClass("now");d(b[c]).addClass("now")});g.find("> li").on("click",function(){d(this).siblings().removeClass("now");d(this).addClass("now")})}var r=m.find("> ul > li");r.click(function(a){a=a.target||Event.srcElement;if("SPAN"==a.nodeName.toUpperCase()||
"LI"==a.nodeName.toUpperCase()){var g=d(this).data("pid");void 0!==g&&(d(this).hasClass("choose")&&3!=f?(d(this).removeClass("choose"),c.removeData("select-pid"),c.removeData("select-prd-price"),b[k].pidIndex=-1):(r.removeClass("choose"),d.each(d(this).siblings("li"),function(a,b){d(b).data("pid")==g&&d(this).addClass("choose")}),d(this).addClass("choose"),c.data("select-pid",g),c.data("select-prd-price",d(this).data("price")),c.data("select-prd-is-spu",d(this).data("is-spu")),b[k].pidIndex=m.find("> ul > .choose").index()))}}).hover(function(){d(this).toggleClass("pic_hover")});
3==f&&a?(d(c.find(".clearfix > li[dd_name$=_1]")[0]).trigger("click"),l.trigger("click"),a=!1):k in b&&(h=!1,d(g.find(">li")[b[k].pageIdx]).trigger("click"),-1!=b[k].pidIndex&&d(r[b[k].pidIndex]).trigger("click"),h=!0)}},loginAction:function(){var a=v("login");if(void 0!=v("login"))a.find("a").on("click",function(){d("body").trigger("loginAction")})},mobilePrice:function(){d("body").trigger("updatePrice",[{type:"mobile",data:n().price,failedCallback:function(){c.off("mobilePrice")}}])},p225:{on:function(a){u.promotion225(a,
f)},off:function(){f.hasOwnProperty("currentId")&&delete f.currentId;var a=d("#buyPackage"),b=d("#buyTogether");a.html("").hide();""!=b.text()&&(b.find("ul.tab > li[data-type=buyPackage]").remove(),b.show())}}}}();y.init=function(){1!==~~n().isPresent&&(d("body").on("initPromo",G).on("updatePromo",C).trigger("updatePromo"),E())};y.hasPromo=function(a){return c.hasPromo(a)};return y}(jQuery);
var coupon=function(b){function n(){f.hide().find("#coupon-list").html("");h.hide()}function p(){var a=l().coupon;q(a);b("#coupon-list").click(function(){showMsgBox("coupon-list","","",r,a)})}function q(a){var b="",d={coupon:a},g=f.find("#tpl-page").html(),b=b+juicer(g,d);a=k(a);""!==b&&0<a&&f.find("#coupon-list").html(b).parent().parent().show()}function k(a){var b=0,d;for(d in a)"function"!=typeof a[d]&&b++;return b}function r(a){var f=k(a),d=[];b("body").trigger("renderAfterLogin");for(var g=0;g<
f;g++)d[g]=a[g].activitySerialNum;d=d.join(",");b.getJSON(window.localUrl,{r:"callback/received-coupon-num",activitySerialNums:d},function(e){if(""==e.errMsg&&0!=e.data.length){e=e.data;for(var d=0;d<e.length;d++)for(var c=0;c<f;c++)a[c].activitySerialNum==e[d].activitySerialNum&&(a[c].activityAwardNum=e[d].activityAwardNum,a[c].restNum=a[c].everyRecNum-a[c].activityAwardNum);e="";d=k(a);for(c=0;c<d;c++)void 0==a[c].restNum||void 0!=a[c].restNum&&0<a[c].restNum?(a[c].quanClass="quan",a[c].btnText=
"立即领取"):(a[c].quanClass="quan quan_over",a[c].btnText="已领取");d={coupon:a};c=b("#coupon-des").html();e+=juicer(c,d);""!==e&&h.html(e).show();b("head").append("<script type='text/javascript' id='couponjs_id' src='"+couponJs+"'>\x3c/script>")}})}function t(){b("#coupon-pop").on("click","#coupon-close",function(){h.hide();b(".coupon_dialog").remove();b("#couponjs_id").remove()})}var m={},f,h,l=function(){return{productId:item.base.productId,mainProductId:item.base.mainProductId,isCatalog:item.base.isCatalog,
isPresent:item.base.isPresent,coupon:item.coupon}};m.init=function(){1!==~~l().isPresent&&(f=b("#coupon-node"),h=b("#coupon-pop"),b("body").on("initCoupon",n).on("updateCoupon",p).trigger("updateCoupon"),t())};return m}(jQuery);
var recommend=function(c){function e(){return{productId:item.base.productId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId,template:item.base.template,shopId:item.base.shopId,stockStatus:item.stock.stockStatus,displayStatus:item.base.displayStatus,salePrice:item.price.salePrice,productName:item.base.productName,productSubName:item.base.productSubName,isCatalog:item.base.isCatalog,isShowOriginalPrice:item.base.isShowOriginalPrice,isWireless:item.base.isWireless,
shopType:item.base.shopType}}function u(b){var a=item.promotion;if(c.isEmptyObject(a)||!a.p28&&!a.p3)return b;for(var g=0,d=b.length;g<d;g++){var f=[];a.p28?f=a.p28.gifts:a.p3&&(f=a.p3.gifts);for(var e=0,l=f.length;e<l;e++)if(b[g].productId==f[e].productId){delete b[g];break}}return b}function v(b){var a=0,c;for(c in b)"function"!=typeof b[c]&&a++;return a}function w(){c("#buytogether_info span.error").hide();var b=c(this).parents("li"),a=c("#buytogether_info"),g=parseInt(a.find("p.num b").text()),
d=parseFloat(a.find("p.price_all_d span").text().substr(1)),f=parseFloat(b.find(".price_d").text().substr(1));b.hasClass("selected")?(b.removeClass("selected"),g--,d-=f):(b.addClass("selected"),g++,d+=f);a.find("p.num b").text(g);a.find("p.price_all_d span").html("&yen;"+d.toFixed(2))}function r(b,a,c,d){var f=parseInt(a.css("left"))+b;a.animate({left:f},300,function(){parseInt(f)>0-c&&a.css("left",(0-c)*d);f<(0-c)*d&&a.css("left",0-c)})}function x(){var b="publish"==e().template?y:z;c.each(b,function(a,
b){var d=isWidth?925:740,f=c("#"+b),h=f.find(".over"),l=f.find("a.prev"),t=f.find("a.next"),k=isWidth?h.data("pagesize")?h.data("pagesize"):5:m[b].width,k={btnPrev:"#"+b+" a.prev",btnNext:"#"+b+" a.next",visible:k,scroll:k,circular:!0};l.hasClass("btn_none")&&(k.circular=!1);if("publish"!=e().template||"historyReco"!=b&&"alsoBuy"!=b)h.jCarouselLite(k);else{f.addClass("mbox_another_two");var p=h.find(">ul"),k=h.find("div.list_page"),n=k.length;1==n&&(l.addClass("btn_none"),t.addClass("btn_none"));
h=k.slice(n-1).clone();k=k.slice(0,1).clone();p.prepend(h).append(k)}l.on("click",function(){if("publish"==e().template&&("historyReco"==b||"alsoBuy"==b)){if(p.is(":animated")||1===n)return;r(d,p,d,n)}var a=parseInt(f.find("#now_page").text()),c=parseInt(f.find("#total_page").text()),h=0,h=1==a?c:parseInt(a)-1;f.find("#now_page").text(h)});t.on("click",function(){if("publish"==e().template&&("historyReco"==b||"alsoBuy"==b)){if(p.is(":animated")||1===n)return;r(0-d,p,d,n)}var a=parseInt(f.find("#now_page").text()),
c=parseInt(f.find("#total_page").text()),h=0,h=a==c?1:a+1;f.find("#now_page").text(h)})})}function A(){var b=c("#buyTogether_lists"),a=c("#buyTogether"),g=c("#buyPackage"),d=3;"publish"==e().template&&(d=4);c("#buyTogether, #buyPackage").find("ul.tab > li").off().click(function(){"buyPackage"==c(this).data("type")?(g.show(),a.hide()):(g.hide(),a.show())});isWidth||0===b.length||(b.find("ul > li").length<=d&&a.find("a.btn_a").hide(),0!=c.trim(g.text()).length&&0!=c.trim(a.text()).length&&(g.hide(),
a.show()),b.jCarouselLite({btnPrev:"#buyTogether a.prev",btnNext:"#buyTogether a.next",visible:d,scroll:d,circular:!1,disabledStyle:"btn_none"}),0!=c.trim(g.text()).length&&0!=c.trim(a.text()).length&&(g.show(),a.hide()))}var y=["nostockReco","alsoBuy","historyReco","nosaleReco"],z=["nostockReco","alsoView","historyReco","nosaleReco"],m={alsoBuy:{width:8},nostockReco:{width:4},historyReco:{width:8},nosaleReco:{width:3},buyTogether:{width:3},alsoView:{width:4}},q={};window.abtest="a";q.init=function(){if("publish"==
e().template)c("#alsoBuy,#alsoView,#alsoAttention,#historyReco").on("mouseover","p.pic",function(){c(this).addClass("pic_hover")}).on("mouseout","p.pic",function(){c(this).removeClass("pic_hover")});else if(c("#alsoView,#alsoAttention,#historyReco").on("mouseover","li",function(){c(this).addClass("pic_hover")}).on("mouseout","li",function(){c(this).removeClass("pic_hover")}),"cloth"==e().template)c("#alsoBuy").on("mouseover","li",function(){c(this).addClass("pic_hover")}).on("mouseout","li",function(){c(this).removeClass("pic_hover")});
c("#buyTogether").on("click","a.choose",w).on("click","#buyTogether_buyButton",function(){if(0==c("#buyTogether_lists").find("li.selected").length)return c(this).next("span.error").show(),!1;q.addCart("buyTogether",2)});"cloth"!==e().template&&delete m.alsoview;c.getJSON(window.localUrl,{r:"callback/recommend",productId:e().mainProductId,shopId:e().shopId,pageType:e().template,module:"7"==e().displayStatus?"nosale":"0"==e().stockStatus?"nostock":"",isBroad:isWidth},function(b){if(""!=b.errMsg)return!1;
"5"==e().shopType&&"undefined"!=typeof b.data.buyTogether&&unset(reponse.data.buyTogether);for(var a in b.data){var g=c("#"+a+"_tpl");b.data[a].isShowOriginalPrice=e().isShowOriginalPrice;b.data[a].screen="w_";if("buyTogether"==a){if("1"!=e().isWireless)if(b.data.buyTogether.list=u(b.data.buyTogether.list),0==v(b.data.buyTogether.list))c("#"+a).hide();else{var d=[];d.mainProductId=e().mainProductId;d.productId=e().productId;d.productName=e().productName;d.productSubName=e().productSubName;var f=c("#largePic").attr("src");
d.productImage=f.substring(0,f.indexOf("_"))+f.substring(f.indexOf("_")).replace(/u|w|e/,"l");d.salePrice=c("#dd-price").text().substr(1);"1"==e().isShowOriginalPrice&&0<c("#dd-zhe").length?d.discount="("+c("#dd-zhe").text()+")":d.discount="";d.isSpu=e().isCatalog;b.data.buyTogether.list.unshift(d);isWidth||(b.data[a].screen="n_",b.data[a].pagesize=m[a].width,"publish"==e().template&&(b.data[a].pagesize=4));for(d=1;d<b.data[a].list.length;d++)b.data[a].list[d].ddtPit=b.data[a].screen+Math.floor((d-
1)/b.data[a].pagesize)+"_"+Math.floor((d-1)%b.data[a].pagesize);g=juicer(g.html(),b.data[a]);c("#"+a).html(g);var h=c("#right-content");0!=h.find(".group_buy:visible").length?(c("#"+a).find("ul.tab").prepend('<li data-type="buyPackage">优惠套餐</li>'),h.find(".group_buy:visible ul.tab").append("<li>拍档组合</li>"),c("#"+a).hide()):c("#"+a).show();h.find(".group_buy ul.tab li").on("click",function(){var a=c(this).index();h.find(".group_buy:eq("+a+")").show().siblings(".group_buy").hide()})}}else{isWidth||
(b.data[a].screen="n_",a in m&&(b.data[a].pagesize=m[a].width,b.data[a].totalPage=Math.ceil(b.data[a].list.length/m[a].width)));for(d in b.data[a].list)b.data[a].list[d].ddtPit=b.data[a].screen+Math.floor(d/b.data[a].pagesize)+"_"+Math.floor(d%b.data[a].pagesize);b.data[a].productId=e().productId;c("#"+a).html(juicer(g.html(),b.data[a])).show()}}x();A();""!=point&&(b=c("#"+point).offset().top,c("html,body").animate({scrollTop:b},0),b=point.substring(0,point.indexOf("_"))+"_tab",c("#"+b).click())})};
q.addCart=function(b,a){var g=c("#"+b),d=!1,f=[];g.find("li.zhu,li.selected").each(function(){var a=c(this).data("pid"),b=c(this).data("select-product-id")?c(this).data("select-product-id"):0,e=c(this).data("number"),g=c(this).data("is-spu");f.push({productId:a,productCount:e,selectProductId:b,isLocal:"0"});"1"==g&&(d=!0)});var e={};225==a&&(e={promoPrice:c("#promotion_buyButton").data("direct-price"),promoId:g.data("promoid"),promoType:"225"});if(d)showListsPop({product:f,moduleType:a,promotion:e,
buttonType:"1"});else{for(var g=prodDCutil.getSourceUrl(),g={product:[],referer:g._url,prev_referer:g._referrer},l=0;l<f.length;l++){var m={productId:f[l].productId,productCount:f[l].productCount,promotion:[]};c.isEmptyObject(e)||m.promotion.push({promotionId:e.promoId});g.product.push(m)}location.href="//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="+encodeURIComponent(prodDDutil.encodeJson(g))}};return q}(jQuery);
var online=function(){function a(){return{productId:item.base.mainProductId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId,productName:item.base.productName,shopId:item.base.shopId,supId:item.base.supId,isShowRobot:item.base.isShowRobot,itemId:item.base.productId}}function g(f){var b=$("#live800"),c=$("#tab-panels"),d=c.find(".icon_dj"),c=c.find(".live800");if("undefined"==typeof f.group_configs||0==f.group_configs.length){if(0==a().shopId&&"1"==
a().isShowRobot)return $("#robotEntry").show(),$("#live800_div").show(),$("#robotEntry").unbind().bind("click",online.showRobot),d.attr("style","display:block"),d.unbind().bind("click",online.showRobot),!1;b.parent("span").hide();0==b.parents(".s_one").children(":visible").length&&b.parents(".s_one").hide();return!1}f.is_valid?(b.attr("class","onlines"),b.unbind().bind("click",online.showDialog),c.unbind().bind("click",online.showDialog)):(b.attr("class","offlines").attr("title","系统暂时繁忙，请您稍后访问"),
b.unbind().bind("click","return false;"));b.show();b.parent("span").show();b.parents(".s_one").show();$("#live800_div").show()}function k(){0<a().shopId&&$.get(window.localUrl,{r:"callback/get-shop-link-phone",shopId:a().shopId},function(a){a&&($("#live800_div").show(),$("#link-phone").show().find("p").html("联系电话："+a))})}var d={entrance_code:"pc_product_detail",position_code:"main",action:"stats"},c={shop_id:0,product:{product_id:1,product_name:""},supplier_id:0},e={entrance_code:"pc_shop_frontpage",
shop_id:0,fields:"group_configs,service_times,is_valid,user_info",supplier_id:0},h={judge:function(){return!("undefined"==typeof showImDialog||"undefined"==typeof showSupplierImDialog||"undefined"==typeof getMerchantGroupInfo||"undefined"==typeof getSupplierGroupInfo)},init:function(){$.getScript(imipUrl,function(){c={shop_id:a().shopId,product:{product_id:a().productId,product_name:a().productName},supplier_id:a().supId};e.shop_id=a().shopId;e.supplier_id=a().supId;if(!h.judge())return!1;showImDialog(d,
c);0==a().shopId?getSupplierGroupInfo(e,g):getMerchantGroupInfo(e,g)});k()},showDialog:function(){showMsgBox("online_service",c.product.product_id,"",online.callbackShowDialog)},callbackShowDialog:function(){d.action="";0==a().shopId?showSupplierImDialog(d,c):showImDialog(d,c);$("body").trigger("renderAfterLogin")},showGroup:function(a){var b=$("#live800_group_div");$(a).hasClass("score_hover")?($(a).removeClass("score_hover"),b.hide()):($(a).addClass("score_hover"),b.show())},showRobot:function(){var c=
$("#robotEntry").attr("robotUrl");window.open(c+a().itemId)}};return h}();
var search=function(){function e(){var a=arguments,b=a[0]||"",c,d;c=1;for(d=a.length;c<d;c++)b=b.replace(/%s/,a[c]);return b}return{init:function(){$.getJSON(window.localUrl,{r:"callback/get-shop-category",shopId:item.base.shopId},function(a){if(""!=a.errMsg)return!1;var b="",c="";50<a.data.length&&$("#shop_category_list").attr("style","overflow-y:scroll;");for(var d in a.data)a.data.hasOwnProperty(d)&&(b+='<a href="javascript:void(0)" categoryid = '+a.data[d].Category+">"+a.data[d].Name+"</a>",c+=
'<li><a href="'+e("http://shop.dangdang.com/storeoutersearch.php?shop_id=%s&key=%s&inner_cat=%s",a.data[d].shopID,"",a.data[d].Category)+'" target="_blank">'+a.data[d].Name+"</a></li>");""!=b&&($("#category_list").html(b),$("#search").show());""!=c&&$("#shop_category_list").html(c).parent().show()});$("#shop_search_btn").on("click",function(){var a=encodeURIComponent($("#shop_search_text").val()),b=$("#shop_search_category").attr("category"),a=e("http://shop.dangdang.com/storeoutersearch.php?shop_id=%s&key=%s&inner_cat=%s",
item.base.shopId,a,b);$(this).attr("href",a)});$("#category_list").on("click","a",function(){$(this).attr("categoryId");$("#shop_search_category").val($(this).text()).attr("category",$(this).attr("categoryid"));$("#category_list").hide()});$("#show_category_list").click(function(){$("#category_list").is(":hidden")?$("#category_list").show():$("#category_list").hide()});$(document).click(function(a){a=a?a:window.event;"show_category_list"!=(a.srcElement||a.target).id&&$("#category_list").hide()})}}}(jQuery);
var bang=function(){function g(){return{productId:item.base.productId,template:item.base.template,categoryPath:item.base.categoryPath}}function h(){$.getJSON(window.localUrl,{r:"callback/get-bang-rank",productId:g().productId},function(e){if(""==e.errMsg){var c;c='<span class="t1" dd_name="图书排行榜排名">在'+('<a href="'+e.data.url+'" target="_blank">当当'+e.data.pathName+"榜</a>排名");c+='<span class="num">'+e.data.rank+"</span>位</span>";$(".pinglun").prepend(c)}})}function l(){var e=$("#bang_div"),c=$("#bang_tab"),
k=$("#bang_div .list02"),h=$("#bang_div .link_more");$.getJSON(window.localUrl,{r:"callback/get-bang-data",categoryPath:g().categoryPath},function(a){if(""==a.errMsg){var b="",d=!1;"undefined"!=typeof a.data.hotBang&&0<a.data.hotBang.data.length&&(b+='<li dd_name="畅销榜">畅销榜</li>',d=!0);"undefined"!=typeof a.data.newBang&&0<a.data.newBang.data.length&&(b+='<li dd_name="新书榜">新书榜</li>',d=!0);if(0==d)return!1;e.show();c.html(b).find("li").mouseover(function(){$(this).addClass("hover").siblings().removeClass("hover");
k.eq($(this).index()).show().siblings(".list02").hide();h.eq($(this).index()).show().siblings(".link_more").hide()});for(var f in a.data)a.data.hasOwnProperty(f)&&(b="",b=juicer('{@each data as list,index}\r\n\t\t\t\t\t\t\t\t<li ddt-pit="${index}">\r\n\t\t\t\t\t\t\t\t\t<span class="num {@if index<3}num_top3{@/if}">${parseInt(index)+1}</span>\r\n\t\t\t\t\t\t\t\t\t<a href="${list.productId}.html" class="pic" dd_name="排行榜商品图片${parseInt(index)+1}" target="_blank" style="display:none">\r\n\t\t\t\t\t\t\t\t\t\t<img id="largePic" src="${list.productImage}" title="${list.productName}&nbsp;${list.subName}">\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t<p class="name" dd_name="排行榜商品名称${parseInt(index)+1}">\r\n\t\t\t\t\t\t            \t<a href="${list.productId}.html" title="${list.productName}&nbsp;${list.subName}" target="_blank">${list.productName}</a>\r\n\t\t\t\t\t\t        \t</p>\r\n\t\t\t\t\t\t            <p class="zuozhe" style="display:none">${list.authorName}</p>\r\n\t\t\t\t\t\t            <p class="price" style="display:none">\r\n\t\t\t\t\t\t            \t<span class="price_d">${list.price}</span>\r\n\t\t\t\t\t\t            \t<span class="price_zhe">${list.discount}</span>\r\n\t\t\t\t\t\t            </p>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t{@/each}',
a.data[f]),d="","hotBang"==f&&(d="018"),"newBang"==f&&(d="019"),$("#"+f+"_data").attr("ddt-area",d),$("#"+f+"_data").html(b));k.find("li").mouseover(function(){$(this).addClass("hover").find(".pic,.zuozhe,.price").each(function(){$(this).show()});$(this).siblings().removeClass("hover").find(".pic,.zuozhe,.price").each(function(){$(this).hide()})});k.find("li:eq(0)").mouseover();c.find("li:eq(0)").mouseover()}})}return{init:function(){if("publish"!=g().template)return!1;h();$("#bang_div").ddlazyload({func:l})}}}(jQuery);
!window.jQuery&&document.write("<script src='http://product.dangdang.com/js/jquery.js'>\x3c/script>");!window.prodDDutil&&document.write("<script src='http://product.dangdang.com/js/ddutil.js'>\x3c/script>");!window.prodDCutil&&document.write("<script src='http://product.dangdang.com/js/dcutil.js'>\x3c/script>");
var productsList=function(){function p(){var b={};b.product=[{productId:$(".info:eq(0)").data("select-id"),productCount:$(".info:eq(0)").data("number"),promotion:[]}];$(".info:gt(0)").each(function(c,f){b.product[0].promotion.push({promotionId:$(f).data("promo-id"),gift:[{giftId:$(f).data("select-id"),giftCount:$(f).data("number")}]})});var c=prodDCutil.getSourceUrl();b.referer=c._url;b.prev_referer=c._referrer;return encodeURIComponent(prodDDutil.encodeJson(b))}function t(b){var c={product:[]};$(".info").each(function(a,
d){var e={productId:$(d).data("select-id"),productCount:$(d).data("number"),promotion:[{promotionId:b}]};c.product.push(e)});var a=prodDCutil.getSourceUrl();c.referer=a._url;c.prev_referer=a._referrer;return encodeURIComponent(prodDDutil.encodeJson(c))}function n(){var b={product:[]};$(".info").each(function(c,a){var d={productId:$(a).data("select-id"),productCount:$(a).data("number")};b.product.push(d)});var c=prodDCutil.getSourceUrl();b.referer=c._url;b.prev_referer=c._referrer;return encodeURIComponent(prodDDutil.encodeJson(b))}
function d(){var b={product_ids:$(".info:eq(0)").data("select-id")+"."+$(".info:eq(0)").data("number"),gift_id:"",exchange_id:"",exchange_price:"",addmoney_id:"",addmoney_price:"",referer:"",prev_referer:""};$(".info:gt(0)").each(function(c,a){28==$(a).data("promo-type")?(b.exchange_id=$.trim($(a).data("select-id")),b.exchange_price=$.trim($(a).find("span[name='price']").data("price"))):3==$(a).data("promo-type")?b.gift_id=$.trim($(a).data("select-id")):229==$(a).data("promo-type")&&(b.addmoney_id=
$.trim($(a).data("select-id")),b.addmoney_price=$.trim($(a).find("span[name='price']").data("price")))});var c=prodDCutil.getSourceUrl();b.referer=c._url;b.prev_referer=c._referrer;return $.param(b)}function e(){$("#masks,#partner_pop").remove();$("body").css({overflow:"scroll"})}var h={},a="",k={},g="",l={},m={};return{productDomain:"product.dangdang.com",getProducts:function(b){h=$.extend({},b.vipInfoObj);a=b.moduleType;k=b.promotion;g=b.buttonType;var c="",d;for(d in b.product)if(b.product.hasOwnProperty(d)){var e=
b.product[d],c=c+(e.productId+",");l["p"+e.productId]=e}c=c.substr(0,c.length-1);$.ajax({type:"GET",url:"//product.dangdang.com?r=callback/get-products",data:{productIds:c},dataType:"jsonp",jsonp:"callback",beforeSend:function(){$("#products-list").html('<div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;_position:absolute;_top:expression(eval(document.documentElement.scrollTop));_height:expression(eval(document.documentElement.clientHeight));background-color:#000;filter:alpha(opacity=20);opacity:0.2;">\r\n\t\t\t\t\t <iframe style="border:none;height:100%;width:100%;opacity=0;filter:alpha(opacity=0);"></iframe></div>\r\n\t\t\t\t\t <div style="position:fixed;left:50%;top:50%;margin-top:-196px;margin-left:-483px;z-index:10001;width:960px;height:400px;background-color:#fff;border:1px solid #ccc;text-align:center;"><p style="height:400px;line-height:400px"><img src="//product.dangdang.com/images/loading2.gif" style="vertical-align:middle">&nbsp;内容加载中，请稍候。。。</p></div>')},
jsonpCallback:"productsList.callbackFunc"})},callbackFunc:function(b){if(""!=b.errMsg)return!1;m={};for(var c in b.data)m[c]=$.extend(b.data[c],l[c]);b=document.getElementsByTagName("head")[0];c=document.createElement("link");c.href="//product.dangdang.com/css/partnerPop.min.css";c.rel="stylesheet";c.type="text/css";b.appendChild(c);$("body").css({overflow:"hidden"});this.showHtml();this.showTotal()},showHtml:function(){var b=m,c;c="";switch(a){case 225:c="优惠套餐中包含以下商品，请选择商品属性";break;case 2:c="拍档组合中包含以下商品，请选择商品属性";
break;case 3:c="赠送以下赠品，请选择商品属性";break;case 28:c="换购以下商品，请选择商品属性"}var d,f='<a href="javascript:void(0)" class="btn btn_red" dd_name="加入购物车" id="pop_addcart"><i class="cart"></i>加入购物车</a>';switch(g){case "2":f='<a href="javascript:void(0)" class="btn btn_b btn_b_red" dd_name="立即购买" id="pop_addcart">立即购买</a>';break;case "3":f='<a href="javascript:void(0)" class="btn btn_green" dd_name="预订" id="pop_addcart"><i class="cart"></i>预订</a>'}d=f;f=[];f.push('<div class="masks" id="masks"><iframe style="border:none;height:100%;width:100%;opacity=0;filter:alpha(opacity=0);"></iframe></div>');
f.push('<div class="partner_pop" id="partner_pop"><h3><span class="hint">'+c+'</span><a href="javascript:void(0)" class="close" id="close_pop"></a></h3>');f.push('<div class="partner_list"><div class="clearfix partner_list_box">');f.push("</div></div>");f.push('<div class="partner_buy">');f.push(d);if(225==a){f.push('<span class="price" id="T_buyPrice">套餐价：<b>&yen;'+k.promoPrice+"</b></span>");c=0;for(var l in b)c+=b[l].productCount;f.push('<span class="jian"><b id="T_buyBum">'+c+"</b>件商品</span>")}else f.push('<span class="price" id="T_buyPrice">总价：<b></b></span>'),
f.push('<span class="jian"><b id="T_buyBum"></b>件商品</span>');f.push("</div></div>");c=$(f.join(""));c.on("click","#close_pop",e).on("click","#pop_addcart",{promotionObj:k,moduleType:a},productsList.addCart);$("#products-list").html(c);f=0;for(l in b)f++,c=product.getHtml(b[l],k,a,h),$(".partner_list_box").append(c),0==f%2&&$(".partner_list_box").append('<div class="clear"></div>')},showTotal:function(){if(225==a)return!1;var b=0,c=0;$(".info").each(function(a,d){""!=$(d).data("select-id")&&(b+=~~$(d).data("number"),
c+=parseFloat($(d).find("span[name='price']").data("price"))*~~$(d).data("number"))});$("#T_buyBum").text(b);$("#T_buyPrice b").html("&yen;"+c.toFixed(2))},addCart:function(b){var c=!0;$(".info").each(function(b,a){if($(this).hasClass("info_hover"))return c=!1;if(""==$(this).data("select-id"))return c=!1,$(this).addClass("info_hover"),!1});if(c)if(1==g||3==g){var a="";3==b.data.moduleType||28==b.data.moduleType?a=p():225==b.data.moduleType?a=t(b.data.promotionObj.promoId):2==b.data.moduleType&&(a=
n());location.href="//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="+a}else 2==g&&(location.href="//checkoutb.dangdang.com/checkout.aspx?checkout_type=10&"+d())}}}(),product=function(){function p(d,e,h,a){var k=function(){var a=0,d;for(d in e.colorSize)e.colorSize.hasOwnProperty(d)&&a++;return a}();if(1==k)for(var g in e.skuInfo)e.skuInfo.hasOwnProperty(g)&&0==e.skuInfo[g].stockStatus.stockStatus&&d.find("a[data-value='"+e.skuInfo[g][h]+"']").addClass("disabled").removeClass("chosen");
else 2==k&&d.find("ul").each(function(){if($(this).data("type")==h)return!0;var d=$(this).data("type");$(this).find("a").each(function(){$(this).removeClass("disabled");var g=$(this).data("value"),b=!1,c;for(c in e.skuInfo)if(e.skuInfo.hasOwnProperty(c)){var k=e.skuInfo[c];k[h]==a&&k[d]==g&&(b=!0,"0"==k.stockStatus.stockStatus&&$(this).addClass("disabled").removeClass("chosen"))}b||$(this).addClass("disabled").removeClass("chosen")})})}function t(d){var e=[],h;for(h in d)d[h].haveStock="0"!=d[h].stockStatus.stockStatus,
d[h].id=h.substr(1),e.push(d[h]);e.sort(function(){return function(a,d){var e=-1;return e=a.haveStock^d.haveStock?a.haveStock?-1:1:a.price.salePrice==d.price.salePrice?a.id-d.id:a.price.salePrice-d.price.salePrice}}());return e[0].id}function n(d,e){var h=e.salePrice;"undefined"!=typeof d&&0<d.userType&&("vipPrice"in e&&1===~~e.isVipDiscount&&(h=e.vipPrice["p"+d.userType]),1===~~e.isShopVip&&"shopVip"in d.userShopType&&(h=e.salePrice*d.userShopType.discount));return h}return{getHtml:function(d,e,
h,a){var k=d.colorSize;"undefined"==typeof a||jQuery.isEmptyObject(a)||this.handlePrice(a);a=[];var g="",l="",m="",b="",c="",p="",f="",n="",q="";if("0"==d.isCatalog){g="//"+productsList.productDomain+"/"+d.productId+".html";l=d.skuInfo.image;m=d.skuInfo.title;q=d.promotion;if("1"==d.isLocal||"225"==h||"2"==h)c="&yen;"+d.skuInfo.price.salePrice,b=d.skuInfo.price.salePrice;else if("undefined"!=typeof q){if("3"==q.promoType)c="",b="0";else if("28"==q.promoType||"229"==q.promoType)c="+&yen;"+q.promoPrice,
b=q.promoPrice;f=q.promoId;n=q.promoType}p=d.skuInfo.productId}a.push('<div class="info" data-select-id="'+p+'" data-number="'+d.productCount+'" data-promo-id="'+f+'" data-promo-type="'+n+'">');a.push('<div class="pic"><a href="'+g+'" target="_blank"><img src="'+l+'" title="'+m+'"></a><span name="price" data-price="'+b+'">'+c+"</span></div>");a.push('<div class="cuxiao_info choose_xilie clearfix">');a.push('<div class="only_title"><a href="'+g+'" target="_blank" title="'+m+'">'+m+"</a></div>");a.push('<div class="clearfix">');
if("object"==typeof k)for(var r in k)if(k.hasOwnProperty(r)){a.push('<div class="left letter02">'+k[r].name+"</div>");a.push('<div class="right"><div class="clearfix">');g=k[r].list;l=g.length;m="jia_gou_e";1==l&&(m+=" chosen");if("undefined"!=typeof g["0"].image)for(a.push('<ul class="list_c" data-type="'+r+'"><li>'),b=0;b<l;b++)a.push('<a href="javascript:void(0)" class="'+m+'" title="'+g[b].value+'" data-value="'+g[b].value+'"><img src="'+g[b].image+'"><i></i></a>');else for(a.push('<ul class="list_r" data-type="'+
r+'"><li>'),b=0;b<l;b++)a.push('<a href="javascript:void(0)" class="'+m+'" title="'+g[b].value+'" data-value="'+g[b].value+'">'+g[b].value+"</a>");a.push("</li></ul>");a.push("</div></div>")}"1"==d.isLocal&&(a.push('<div class="left letter02">数量</div>'),a.push('<div class="right"><div class="num"><input id="buy_number" class="text" value="'+d.productCount+'" type="text" readonly><a href="javascript:void(0)" class="num_add num_disabled" dd_name="数量加"></a><a href="javascript:void(0)" class="num_del num_disabled" dd_name="数量减"></a></div></div>'));
a.push('<div class="hint">请选择您要的商品信息</div></div>');a=$(a.join(""));if("1"==d.isCatalog)for(r in a.find("a.jia_gou_e").bind("click",{obj:d,promotionObj:e,moduleType:h},product.selectEvent),e=d.selectProductId?d.selectProductId:t(d.skuInfo),d=d.skuInfo["p"+e],k)a.find("a[data-value='"+d[r]+"']").trigger("click");return a},selectEvent:function(d){var e=d.data.obj;d=d.data.moduleType;var h=$(this).parents(".info"),a=0,k;for(k in e.colorSize)e.colorSize.hasOwnProperty(k)&&a++;if(1==a&&$(this).hasClass("disabled"))return!1;
h.removeClass("info_hover");$(this).attr("class","jia_gou_e chosen").siblings().removeClass("chosen");k={};var g=$(this).data("value"),a=$(this).parents("ul").data("type");k[a]=g;p(h,e,a,g);var g=!0,l;for(l in e.colorSize)if(e.colorSize.hasOwnProperty(l)&&l!=a){var m=h.find("ul[data-type='"+l+"']").find("a.chosen");1==m.length?k[l]=m.data("value"):g=!1}l={};if(g){for(var b in e.skuInfo)if(e.skuInfo.hasOwnProperty(b)){var a=!0,c;for(c in k)if(k.hasOwnProperty(c)&&e.skuInfo[b][c]!=k[c]){a=!1;break}if(1==
a){l=e.skuInfo[b];break}}b="//"+productsList.productDomain+"/"+l.productId+".html";c=l.title;k=l.image;var n=m=g=a="",f=e.promotion;if("1"==e.isLocal||"225"==d||"2"==d)g="&yen;"+l.price.salePrice,a=l.price.salePrice;else if("undefined"!=typeof f){if("3"==f.promoType)g="",a="0";else if("28"==f.promoType||"229"==f.promoType)g="+&yen;"+f.promoPrice,a=f.promoPrice;m=f.promoId;n=f.promoType}h.data("select-id",l.productId).data("promo-id",m).data("promo-type",n);h.find(".pic").find("span[name='price']").html(g).data("price",
a).end().find("a").attr("href",b).find("img").attr("src",k).attr("title",c);h.find(".only_title a").attr("href",b).attr("title",c).html(c)}else h.data("select-id","");productsList.showTotal()},handlePrice:function(d){var e=this.productObj;if(0==e.isCatalog)e.spuInfo.price.salePrice=n(d,e.spuInfo.price);else{var e=e.skuInfo.itemInfo,h;for(h in e)e[h].price.salePrice=n(d,e[h].price)}}}}();function showListsPop(p){if(jQuery.isEmptyObject(p))return!1;productsList.getProducts(p)};
(function(d){d("body").on("loadSku",function(){var b=[prodOperation,prodBuyNumber,mainImg,Cookie,freight,geo,shop,price,promotion,coupon,online,bang,detail],c=["recommend","comment","question","search"],a;prodDCutil.time.setServerTime(item.base.serverTimeClock);delete item.base.serverTimeClock;for(a=0;a<b.length;a++)void 0!=b[a]&&b[a].hasOwnProperty("init")&&b[a].init();for(a=0;a<c.length;a++)c[a]in window&&d("#"+c[a]).ddlazyload({func:window[c[a]].init})})})(jQuery);
